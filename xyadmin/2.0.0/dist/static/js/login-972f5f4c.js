import e from"./qrlogin-b3b37182.js";import{u as i}from"./util-9d5f29a3.js";import{_ as t}from"./_plugin-vue_export-helper-1b428a4d.js";import"./preload-helper-17f83b6a.js";import"./_commonjsHelpers-fb96ccea.js";const a={components:{qrlogin:e},data(){var e,t,a,o;return{supportQrlogin:!1,qrloginShow:!1,activeData:"",srvList:i.getSrvList(),showSrvlist:!1,baseUrl:"",admin2step:"",login:{loading:!1,account:"",password:"",googleAuth:"",mobileVerify:"",emailVerify:"",captchaVerify:""},loginRule:{account:[{required:!0,message:"请填写账号",trigger:"blur"}],password:[{required:!0,message:"请填写密码",trigger:"blur"},{type:"string",min:6,message:"密码至少6位",trigger:"blur"}]},useVerify:null==(o=null==(a=null==(t=null==(e=this.activeData)?void 0:e.app)?void 0:t.apiInfo)?void 0:a.config)?void 0:o.useVerify}},async created(){var e,i,t,a;this.$xyutil.getStorageSync("account")&&(this.login.account=this.$xyutil.getStorageSync("account"),this.login.password=this.$xyutil.getStorageSync("password")),this.baseUrl=this.$xyutil.getStorageSync("xyadmin-active"),this.$route.query.mul?(this.showSrvlist=!0,this.baseUrl||(this.baseUrl=window.location.protocol+"//"+window.location.host+window.location.pathname+"api")):this.baseUrl=window.location.protocol+"//"+window.location.host+window.location.pathname+"api",await this.getSiteInfo(),this.useVerify=null==(a=null==(t=null==(i=null==(e=this.activeData)?void 0:e.app)?void 0:i.apiInfo)?void 0:t.config)?void 0:a.useVerify,this.activeData.app.apiInfo.qrlogin&&(this.supportQrlogin=!0,this.activeData.app.apiInfo.qrlogin.isDefault&&(this.qrloginShow=!0))},methods:{bindPickerChange:function(e){e&&(this.baseUrl=e)},verifySuccess(e){this.login.captchaVerify=e,this.loginSubmit()},useVerifyShow(){this.$refs.verify&&this.$refs.verify.show()},async handleSubmit(){await this.getSiteInfo(),this.activeData.app.apiInfo.config&&this.activeData.app.apiInfo.config.useVerify?this.useVerifyShow():this.loginSubmit()},async getSiteInfo(){if(this.baseUrl)if(this.$xyutil.setStorageSync("xyadmin-active",this.baseUrl),this.activeData=this.$xyutil.getStorageSync("xyadmin-vuex-"+this.baseUrl),this.activeData||(this.activeData=this.$xyutil.getStorageSync("xyadmin-vuex-default")),this.activeData){this.activeData=JSON.parse(this.activeData);let e=await this.$xyutil.request({url:this.baseUrl,method:"get"});if(200!=e.code)return this.$xyutil.showToast({title:"接口异常，请检查服务器接口！",icon:"loading",duration:2e3}),!1;e.data.api.urlLogin&&(window.location.href=e.data.api.urlLogin),this.activeData.app.apiInfo=e.data,e.data.siteInfo&&(e.data.siteInfo.admin2step&&(this.admin2step=e.data.siteInfo.admin2step.login[0]),this.activeData.app.baseUrl=this.baseUrl,this.activeData.app.siteInfo=e.data.siteInfo)}else alert("不存在xyadmin-vuex-default")},loginSubmit:async function(){this.login.loading=!0;let e=this;setTimeout((function(){e.login.loading=!1}),5e3);let i=await this.$xyutil.request({url:this.activeData.app.apiInfo.api.apiBase+this.activeData.app.apiInfo.api.apiLogin,data:this.login,method:"post"});200==i.code?(this.activeData.user.token=i.data.token,this.activeData.user.userInfo=i.data.userInfo,this.activeData.menu.menuList="",this.$xyutil.showToast({title:i.msg,icon:"success",duration:1e3}),this.$xyutil.setStorageSync("xyadmin-vuex-"+this.baseUrl,JSON.stringify(this.activeData)),this.$xyutil.reLaunch()):this.$xyutil.showToast({title:i.msg,icon:"loading",duration:3e3}),this.login.loading=!1}}},o=window.Vue.resolveComponent,l=window.Vue.createVNode,n=window.Vue.createElementVNode,s=window.Vue.toDisplayString,r=window.Vue.renderList,u=window.Vue.Fragment,p=window.Vue.openBlock,c=window.Vue.createElementBlock,d=window.Vue.createBlock,h=window.Vue.withCtx,g=window.Vue.withKeys,f=window.Vue.vShow,w=window.Vue.withDirectives,v=window.Vue.createTextVNode,m=window.Vue.createCommentVNode,y=window.Vue.pushScopeId,S=window.Vue.popScopeId,x={class:"wrap"},b={style:{width:"100%",color:"#fff","margin-bottom":"30px"}},V=["src"],D={key:0,class:"qrlogin-modal"},I={class:"flex space-between m-b"},q=(e=>(y("data-v-55e6cf5b"),e=e(),S(),e))((()=>n("div",null,null,-1))),U={class:"text-center m-t"};const k=t(a,[["render",function(e,i,t,a,y,S){const k=o("vue-particles"),$=o("el-option"),_=o("el-select"),C=o("el-input"),L=o("el-form-item"),j=o("el-button"),N=o("el-form"),T=o("qrlogin"),O=o("el-col"),P=o("el-row"),z=o("vue2-verify");return p(),c("div",x,[l(k,{color:"#808695",linesColor:"#808695",linesWidth:1,lineLinked:!0,lineOpacity:.4,linesDistance:150,particleOpacity:.7,particlesNumber:60,shapeType:"circle",particleSize:4,moveSpeed:1,hoverEffect:!0,hoverMode:"grab",clickEffect:!0,clickMode:"push",class:"slider-particles"},null,8,["lineOpacity","particleOpacity"]),l(P,{class:"main",type:"flex",justify:"center",gutter:0},{default:h((()=>[l(O,{xs:20,sm:10,md:6,lg:5,class:"login-box"},{default:h((()=>[n("div",b,[n("img",{style:{width:"120px","margin-bottom":"10px"},src:e.$store.state.app.siteInfo.logo},null,8,V),n("h2",null,s(e.$store.state.app.siteInfo.title)+"后台登录",1)]),y.qrloginShow?m("",!0):(p(),d(N,{key:0,ref:"login",model:y.login,rules:y.loginRule,inline:!1,size:"large"},{default:h((()=>[l(L,{label:""},{default:h((()=>[l(C,{type:"text",modelValue:y.baseUrl,"onUpdate:modelValue":i[1]||(i[1]=e=>y.baseUrl=e),"prefix-icon":"el-icon-user",placeholder:"接口"},{prepend:h((()=>[l(_,{style:{width:"80px"},onChange:i[0]||(i[0]=i=>{var t,a,o;return S.bindPickerChange(null==(o=null==(a=null==(t=e.item)?void 0:t.val)?void 0:a.app)?void 0:o.baseUrl)})},{default:h((()=>[(p(!0),c(u,null,r(y.srvList,((e,i)=>{var t,a;return p(),d($,{key:i,value:e.val.app.siteInfo.title,label:e.val.app.siteInfo.title+""+(null==(a=null==(t=null==e?void 0:e.val)?void 0:t.app)?void 0:a.baseUrl)},null,8,["value","label"])})),128))])),_:1})])),_:1},8,["modelValue"])])),_:1}),l(L,{prop:"account"},{default:h((()=>[l(C,{type:"text",modelValue:y.login.account,"onUpdate:modelValue":i[2]||(i[2]=e=>y.login.account=e),"prefix-icon":"el-icon-user",placeholder:"账号"},null,8,["modelValue"])])),_:1}),l(L,{prop:"password"},{default:h((()=>[l(C,{type:"password",modelValue:y.login.password,"onUpdate:modelValue":i[3]||(i[3]=e=>y.login.password=e),"prefix-icon":"el-icon-lock",placeholder:"密码",onKeyup:i[4]||(i[4]=g((e=>S.handleSubmit("login")),["enter","native"]))},null,8,["modelValue"])])),_:1}),l(L,{prop:"googleAuth"},{default:h((()=>[w(l(C,{type:"text",modelValue:y.login.googleAuth,"onUpdate:modelValue":i[5]||(i[5]=e=>y.login.googleAuth=e),prefix:"ios-person-outline",placeholder:"谷歌验证"},null,8,["modelValue"]),[[f,"googleAuth"==this.admin2step]])])),_:1}),l(L,null,{default:h((()=>[l(j,{class:"full",type:"primary",loading:y.login.loading,onClick:i[6]||(i[6]=e=>S.handleSubmit("login"))},{default:h((()=>[v("登录")])),_:1},8,["loading"])])),_:1})])),_:1},8,["model","rules"])),y.supportQrlogin?(p(),c(u,{key:1},[w(n("div",{class:"qrlogin",onClick:i[7]||(i[7]=e=>{y.qrloginShow=!0})},null,512),[[f,!y.qrloginShow]]),y.activeData.app.apiInfo.qrlogin?w((p(),c("div",D,[n("div",I,[q,n("div",null,[n("span",{onClick:i[8]||(i[8]=e=>{y.qrloginShow=!1}),class:"cursor-pointer"},"账号密码登录")])]),l(T,{class:"text-center",qrloginShow:y.qrloginShow,qrurlPrefix:y.activeData.app.apiInfo.qrlogin.qrurlPrefix,apiSeed:y.activeData.app.apiInfo.qrlogin.apiSeed},null,8,["qrloginShow","qrurlPrefix","apiSeed"]),n("div",U,s(y.activeData.app.apiInfo.qrlogin.tip),1)],512)),[[f,y.qrloginShow]]):m("",!0)],64)):m("",!0)])),_:1})])),_:1}),y.useVerify?(p(),d(z,{key:0,onSuccess:S.verifySuccess,mode:"pop",baseUrl:y.activeData.app.apiInfo.domainRoot,captchaType:"blockPuzzle",imgSize:{width:"330px",height:"155px"},ref:"verify"},null,8,["onSuccess","baseUrl"])):m("",!0)])}],["__scopeId","data-v-55e6cf5b"]]);export{k as default};
