import{_ as e}from"./preload-helper-17f83b6a.js";import{l as t}from"./index-d75135cf.js";import{b as a}from"./button-b62f2969.js";import{u as o}from"./util-73084cee.js";import{_ as i}from"./_plugin-vue_export-helper-1b428a4d.js";const l=window.Vue.toDisplayString,n=window.Vue.createElementVNode,d=window.Vue.createTextVNode,r=window.Vue.resolveComponent,s=window.Vue.withCtx,u=window.Vue.createVNode,c=window.Vue.renderList,p=window.Vue.Fragment,h=window.Vue.openBlock,m=window.Vue.createElementBlock,g=window.Vue.createBlock,f=window.Vue.resolveDynamicComponent,w=window.Vue.vShow,y=window.Vue.withDirectives,D=window.Vue.createCommentVNode,v=window.Vue.resolveDirective;window.Vue.pushScopeId,window.Vue.popScopeId;const _={class:"xy-builder-comp xy-builder-wrap-col"},C={class:"col-box"},x={class:"custom-tree-node flex flex-1 flex-alignCenter"},b=["onClick"],k={class:"actions ts-13",style:{display:"none"}},V={class:"m-t"},B={id:"contextmenu",class:"menu"},T=["onClick"],I=window.Vue.ref,E=window.Vue.defineAsyncComponent,L={name:"XyBuilderCol",mixins:[a],props:{api:"",header:{type:Object,default:()=>({cloudId:0,eid:0})},pitem:{type:Object,default:()=>({})},show:!1,predata:"",showDev:!1},data:()=>({id:0,ready:!1,loading:!1,menuVisible:!1,cnode:null,cdata:null,colData:{dataList:[],config:{labelField:"title",rightContentType:"form",rightContentApi:"",modalDefaultWidth:800}},colCurrentDataiId:"",currentEditApi:""}),watch:{api(e){this.loadData()},show(e){this.stackData={},1==e&&this.loadData()}},computed:{listData(){return this.colData},rightContentApi(){var e,t;return(null==(t=null==(e=this.colData)?void 0:e.config)?void 0:t.rightContentApi)+"?from=ColBuilder&colCurrentDataiId="+this.colCurrentDataiId}},components:{XyBuilderTab:E((()=>new Promise(((t,a)=>{e((()=>import("./xy-builder-tab-6aa15080.js").then((e=>e._))),["static/js/xy-builder-tab-6aa15080.js","static/js/preload-helper-17f83b6a.js","static/js/index-d75135cf.js","static/js/_commonjsHelpers-fb96ccea.js","static/js/_plugin-vue_export-helper-1b428a4d.js","static/css/xy-builder-tab-b293483b.css"]).then((e=>{t(e)}))})))),XyBuilderInfo:E((()=>new Promise(((t,a)=>{e((()=>import("./xy-builder-info-ba1efe63.js").then((e=>e._))),["static/js/xy-builder-info-ba1efe63.js","static/js/preload-helper-17f83b6a.js","static/js/button-b62f2969.js","static/js/index-d75135cf.js","static/js/_commonjsHelpers-fb96ccea.js","static/js/_plugin-vue_export-helper-1b428a4d.js","static/css/xy-builder-info-9865521e.css"]).then((e=>{t(e)}))})))),XyBuilderList:E((()=>new Promise(((t,a)=>{e((()=>import("./xy-builder-list-8ce0f8b0.js").then((e=>e._))),["static/js/xy-builder-list-8ce0f8b0.js","static/js/preload-helper-17f83b6a.js","static/js/index-d75135cf.js","static/js/_commonjsHelpers-fb96ccea.js","static/js/button-b62f2969.js","static/js/_plugin-vue_export-helper-1b428a4d.js","static/js/util-73084cee.js","static/css/xy-builder-list-d2f6d00b.css"]).then((e=>{t(e)}))})))),XyBuilderForm:E((()=>new Promise(((t,a)=>{e((()=>import("./xy-builder-form-c3777d21.js").then((e=>e.a))),["static/js/xy-builder-form-c3777d21.js","static/js/preload-helper-17f83b6a.js","static/js/util-73084cee.js","static/js/index-d75135cf.js","static/js/_commonjsHelpers-fb96ccea.js","static/js/_plugin-vue_export-helper-1b428a4d.js","static/css/xy-builder-form-fb0ad44f.css"]).then((e=>{t(e)}))}))))},created(){this.predata?this.readyProcess(this.predata):this.loadData()},methods:{closeModel(e,t){1==t&&this.loadData(),e.pageData.show=!1},handleContextmenu(e,t,a,o){this.cnode=a,this.cdata=t,this.menuVisible=!1,this.menuVisible=!0,e.preventDefault();var i=document.querySelector(".menu");this.styleMenu(e,i)},foo(){this.menuVisible=!1,document.removeEventListener("click",this.foo)},styleMenu(e,t){e.clientX>1800?t.style.left=e.clientX-100+"px":t.style.left=e.clientX-200+"px",document.addEventListener("click",this.foo),e.clientY>700?t.style.top=e.clientY-300+"px":t.style.top=e.clientY-150+"px"},async handleDrop(e,t,a,o){let i;this.colData.rightButtonList.forEach((e=>{"edit"==e.name&&(i=e)}));let l="",n=0;switch(a){case"inner":l=t.data.uniqeId;break;case"before":l=t.data.puniqeId,n=t.data.sortnum-1;break;case"after":l=t.data.puniqeId,n=t.data.sortnum+1}let d=await this.$xyutil.request({url:i.pageData.api+"/"+e.data.id,method:"put",data:{puniqeId:l,sortnum:n},header:{CloudId:this.header.cloudId,Eid:this.header.eid}});"200"==d.code?this.$xyutil.showToast({title:d.msg,icon:"success",duration:1e3}):this.$xyutil.showToast({title:d.msg,icon:"error",duration:3e3})},async clickCurrentNode(e,t){var a,o;switch(null==(o=null==(a=this.colData)?void 0:a.config)?void 0:o.rightContentType){case"form":this.$refs.rightForm.getCount()>1?this.$confirm("您有修改内容未保存，确认离开当前页面吗？","提示",{confirmButtonText:"确认离开",cancelButtonText:"留在页面",confirmButtonClass:"el-button--danger",closeOnClickModal:!1,type:"error"}).then((async()=>{this.edit(e,t)})).catch((()=>{})):this.edit(e,t);break;case"list":this.colCurrentDataiId=t.id;break;default:alert("未设置rightContentType")}},async edit(e,a){this.cnode=null,this.cdata=null,this.menuVisible=!1;let o=this;this.colData.rightButtonList.forEach((e=>{if("edit"==e.name){let n=e;var i="",l=new Object;if(n.pageData.apiSuffix){let e=n.pageData.apiSuffix;for(let t of e)i=i+"/"+a[t]}else i="/"+a.id;if(n.pageData.querySuffix){let e=n.pageData.querySuffix;for(let t of e)1==t[2]?l[t[0]]=t[1]:l[t[0]]=a[t[1]]}if(""!=t.stringify(l)?o.currentEditApi=n.pageData.api+i+"?"+t.stringify(l):o.currentEditApi=n.pageData.api+i,!o.currentEditApi)return!1}}))},readyProcess(e){let t=o.readyList({listData:e},this.$store.state.app.apiInfo);this.colData={...t.listData},this.ready=!0},async loadData(e=""){var t,a;if(""!=e&&(this.api=e),this.loading=!0,this.api){let e=await this.$xyutil.request({url:this.api,method:"get",header:{CloudId:null==(t=this.header)?void 0:t.cloudId,Eid:null==(a=this.header)?void 0:a.eid}});"200"==e.code?(this.readyProcess(e.data.colData),this.id=e.data.id,this.loading=!1):this.$xyutil.showToast({title:e.msg,icon:"loading",duration:3e3})}this.loading=!1}}},A=i(Object.assign(L,{setup(e){const t=I("el-dialog");return I("el-drawer"),(a,o)=>{const i=r("el-link"),I=r("el-tree"),E=r("el-button"),L=r("el-col"),A=r("XyBuilderForm"),j=r("el-row"),O=v("loading");return h(),m("div",_,[y((h(),m("div",C,[u(j,{gutter:25},{default:s((()=>[u(L,{xs:24,sm:24,md:6,lg:5,class:"left m-b-md"},{default:s((()=>{var o;return[u(I,{class:"",data:a.colData.dataList,"node-key":"id","default-expand-all":"","highlight-current":"",draggable:null==(o=a.colData.config)?void 0:o.allowHandleDrop,onNodeContextmenu:a.handleContextmenu,onNodeDrop:a.handleDrop,"expand-on-click-node":!1},{default:s((({node:e,data:t})=>{var o,r;return[n("div",x,[n("div",{style:{height:"100%"},class:"flex-1 ts-14 tw5 flex flex-alignCenter",onClick:o=>a.clickCurrentNode(e,t)},l(t[(null==(r=null==(o=a.colData)?void 0:o.config)?void 0:r.labelField)||"title"]),9,b),n("div",k,[u(i,{class:"m-r-xs",type:"text",onClick:()=>a.append(e,t)},{default:s((()=>[d(" 添加子项 ")])),_:2},1032,["onClick"]),u(i,{class:"m-r-xs",type:"text",onClick:()=>a.edit(e,t)},{default:s((()=>[d(" 编辑 ")])),_:2},1032,["onClick"]),u(i,{type:"danger",onClick:()=>a.remove(e,t)},{default:s((()=>[d(" 删除 ")])),_:2},1032,["onClick"])])])]})),_:1},8,["data","draggable","onNodeContextmenu","onNodeDrop"]),n("div",V,[(h(!0),m(p,null,c(a.colData.topButtonList,((e,t)=>(h(),g(E,{key:"button"+t,"empty-text":"当前没有数据",plain:!(!e.style.plain&&"light"!=a.buttonType),ttype:"item.style.type || 'primary'",size:e.style.size||"medium",icon:e.style.icon,onClick:e=>a.topButtonModal(t),style:{"margin-bottom":"10px"}},{default:s((()=>[d(l(e.title),1)])),_:2},1032,["plain","size","icon","onClick"])))),128))]),(h(!0),m(p,null,c(a.colData.topButtonList,((o,i)=>(h(),m("div",{key:"top_modal_"+i,name:"el-zoom-in-top"},[(h(),g(f((o.pageData.pageType,t.value)),{"vv-el-drag-dialog":"","close-on-click-modal":!!o.pageData.hasOwnProperty("modalClosable")&&o.pageData.modalClosable,"append-to-body":!0,ref_for:!0,ref:"top_modal_"+o.name,modelValue:o.pageData.show,"onUpdate:modelValue":e=>o.pageData.show=e,width:o.pageData.width||"800px",size:o.pageData.width||"800px",title:o.pageData.title},{default:s((()=>{var t;return[(h(),g(f("XyBuilder"+o.pageData.modalType.charAt(0).toUpperCase()+o.pageData.modalType.slice(1)),{ref_for:!0,ref:"top_dialog_"+i,api:o.pageData.apiBlank,show:o.pageData.show,header:e.header,pitem:o,showDev:e.showDev,outUrl:null==(t=o.pageData)?void 0:t.outUrl,onClose:e=>a.closeModel(o,e)},null,40,["api","show","header","pitem","showDev","outUrl","onClose"]))]})),_:2},1032,["close-on-click-modal","modelValue","onUpdate:modelValue","width","size","title"]))])))),128)),y(n("div",B,[(h(!0),m(p,null,c(a.colData.rightButtonList,((e,t)=>(h(),m("div",{key:"rbutton"+t,class:"contextmenu__item",onClick:()=>a.rightButtonModal(t,{row:a.cdata})},l(e.title),9,T)))),128))],512),[[w,a.menuVisible]]),(h(!0),m(p,null,c(a.colData.rightButtonList,((o,i)=>(h(),g(f((o.pageData.pageType,t.value)),{key:"right_modal_"+i,"vv-el-drag-dialog":"",onOpen:a.dialogOpen,onClose:a.dialogClose,"close-on-click-modal":!0===o.pageData.modalClosable||"drawer"==o.pageData.pageType,"append-to-body":!0,ref_for:!0,ref:"right_modal_"+o.name,modelValue:o.pageData.show,"onUpdate:modelValue":e=>o.pageData.show=e,width:o.pageData.width||"800",size:o.pageData.width||"800",title:o.pageData.title},{default:s((()=>{var t;return[o.pageData.show?(h(),g(f("XyBuilder"+o.pageData.modalType.charAt(0).toUpperCase()+o.pageData.modalType.slice(1)),{key:0,ref_for:!0,ref:"right_form_"+i,api:o.pageData.apiBlank,show:o.pageData.show,header:e.header,pitem:o,showDev:e.showDev,outUrl:null==(t=o.pageData)?void 0:t.outUrl,onClose:e=>a.closeModel(o,e)},null,40,["api","show","header","pitem","showDev","outUrl","onClose"])):D("",!0)]})),_:2},1064,["onOpen","onClose","close-on-click-modal","modelValue","onUpdate:modelValue","width","size","title"])))),128))]})),_:1}),u(L,{xs:24,sm:24,md:18,lg:19,class:"right"},{default:s((()=>{var t,i,l,n,d,r;return["form"==(null==(i=null==(t=a.colData)?void 0:t.config)?void 0:i.rightContentType)?(h(),g(A,{key:0,ref:"rightForm",api:a.currentEditApi,show:!0,header:e.header,onClose:o[0]||(o[0]=e=>a.closeModel(e))},null,8,["api","header"])):(h(),g(f("XyBuilder"+(null==(n=null==(l=a.colData)?void 0:l.config)?void 0:n.rightContentType.charAt(0).toUpperCase())+(null==(r=null==(d=a.colData)?void 0:d.config)?void 0:r.rightContentType.slice(1))),{key:1,ref:"rightList",api:a.rightContentApi,show:!0,header:e.header,onClose:o[1]||(o[1]=e=>a.closeModel(e))},null,40,["api","header"]))]})),_:1})])),_:1})])),[[O,a.loading]])])}}}),[["__scopeId","data-v-74582277"]]),j=Object.freeze(Object.defineProperty({__proto__:null,default:A},Symbol.toStringTag,{value:"Module"}));export{A as X,j as _};
