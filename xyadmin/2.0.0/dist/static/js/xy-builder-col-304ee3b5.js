import{_ as e}from"./preload-helper-17f83b6a.js";import{l as t}from"./index-d75135cf.js";import{u as i}from"./util-a8f74a38.js";import{_ as a}from"./_plugin-vue_export-helper-1b428a4d.js";const o=window.Vue.defineAsyncComponent,n={name:"XyBuilderCol",props:{api:"",header:{type:Object,default:()=>({cloudId:0,eid:0})},pitem:{type:Object,default:()=>({})},show:!1,predata:""},data:()=>({id:0,ready:!1,loading:!1,menuVisible:!1,cnode:null,cdata:null,colData:{dataList:[]},currentEditApi:""}),watch:{show(e){this.stackData={},1==e&&this.loadData()}},components:{XyBuilderTab:o((()=>new Promise(((t,i)=>{e((()=>import("./xy-builder-tab-0301d4d2.js").then((e=>e._))),["static/js/xy-builder-tab-0301d4d2.js","static/js/preload-helper-17f83b6a.js","static/js/index-d75135cf.js","static/js/_commonjsHelpers-fb96ccea.js","static/js/_plugin-vue_export-helper-1b428a4d.js","static/css/xy-builder-tab-b293483b.css"]).then((e=>{t(e)}))})))),XyBuilderInfo:o((()=>new Promise(((t,i)=>{e((()=>import("./xy-builder-info-3e1af325.js").then((e=>e._))),["static/js/xy-builder-info-3e1af325.js","static/js/preload-helper-17f83b6a.js","static/js/button-fc4aadfc.js","static/js/index-d75135cf.js","static/js/_commonjsHelpers-fb96ccea.js","static/js/_plugin-vue_export-helper-1b428a4d.js","static/css/xy-builder-info-7d9a40eb.css"]).then((e=>{t(e)}))})))),XyBuilderList:o((()=>new Promise(((t,i)=>{e((()=>import("./xy-builder-list-42a32f68.js").then((e=>e._))),["static/js/xy-builder-list-42a32f68.js","static/js/preload-helper-17f83b6a.js","static/js/index-d75135cf.js","static/js/_commonjsHelpers-fb96ccea.js","static/js/button-fc4aadfc.js","static/js/_plugin-vue_export-helper-1b428a4d.js","static/js/util-a8f74a38.js","static/css/xy-builder-list-0bdd69f4.css"]).then((e=>{t(e)}))})))),XyBuilderForm:o((()=>new Promise(((t,i)=>{e((()=>import("./xy-builder-form-927ef9c2.js").then((e=>e.a))),["static/js/xy-builder-form-927ef9c2.js","static/js/preload-helper-17f83b6a.js","static/js/util-a8f74a38.js","static/js/index-d75135cf.js","static/js/_commonjsHelpers-fb96ccea.js","static/js/_plugin-vue_export-helper-1b428a4d.js","static/css/xy-builder-form-5c7b87f1.css"]).then((e=>{t(e)}))}))))},created(){this.predata?this.readyProcess(this.predata):this.loadData()},methods:{closeModel(){},handleContextmenu(e,t,i,a){this.cnode=i,this.cdata=t,this.menuVisible=!1,this.menuVisible=!0,event.preventDefault();var o=document.querySelector(".menu");this.styleMenu(o)},foo(){this.menuVisible=!1,document.removeEventListener("click",this.foo)},styleMenu(e){event.clientX>1800?e.style.left=event.clientX-100+"px":e.style.left=event.clientX-200+"px",document.addEventListener("click",this.foo),event.clientY>700?e.style.top=event.clientY-300+"px":e.style.top=event.clientY-150+"px"},async handleDrop(e,t,i,a){let o;this.colData.rightButtonList.forEach((e=>{"edit"==e.name&&(o=e)}));let n="",d=0;switch(i){case"inner":n=t.data.uniqeId;break;case"before":n=t.data.puniqeId,d=t.data.sortnum-1;break;case"after":n=t.data.puniqeId,d=t.data.sortnum+1}let s=await this.$xyutil.request({url:o.pageData.api+"/"+e.data.id,method:"put",data:{puniqeId:n,sortnum:d},header:{CloudId:this.header.cloudId,Eid:this.header.eid}});"200"==s.code?this.$xyutil.showToast({title:s.msg,icon:"success",duration:1e3}):this.$xyutil.showToast({title:s.msg,icon:"error",duration:3e3})},async editPre(e,t){this.$refs.rightForm.getCount()>1?this.$confirm("您有修改内容未保存，确认离开当前页面吗？","提示",{confirmButtonText:"确认离开",cancelButtonText:"留在页面",confirmButtonClass:"el-button--danger",closeOnClickModal:!1,type:"error"}).then((async()=>{this.edit(e,t)})).catch((()=>{})):this.edit(e,t)},async edit(e,i){this.$refs.rightForm.getCount(),this.cnode=null,this.cdata=null,this.menuVisible=!1;let a=this;this.colData.rightButtonList.forEach((e=>{if("edit"==e.name){let d=e;var o="",n=new Object;if(d.pageData.apiSuffix){let e=d.pageData.apiSuffix;for(let t of e)o=o+"/"+i[t]}else o="/"+i.id;if(d.pageData.querySuffix){let e=d.pageData.querySuffix;for(let t of e)1==t[2]?n[t[0]]=t[1]:n[t[0]]=i[t[1]]}if(""!=t.stringify(n)?a.currentEditApi=d.pageData.api+o+"?"+t.stringify(n):a.currentEditApi=d.pageData.api+o,!a.currentEditApi)return!1}}))},async append(e,t){t||((t={}).bookId=this.id,t.puniqeId="",t.title="根节点");let i="";if(this.colData.rightButtonList.forEach((e=>{"addChild"==e.name&&(i=e.pageData.api)})),!i)return!1;this.$prompt("请输入标题","创建“"+t.title+"”的子项",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((async({value:a})=>{let o=await this.$xyutil.request({url:i,method:"post",data:{bookId:t.bookId,puniqeId:t.uniqeId,title:a},header:{CloudId:this.header.cloudId,Eid:this.header.eid}});"200"==o.code?(this.$xyutil.showToast({title:o.msg,icon:"success",duration:1e3}),t.children||this.$set(t,"children",[]),e?t.children.push(o.data.info):this.colData.dataList.push(o.data.info)):this.$xyutil.showToast({title:o.msg,icon:"error",duration:3e3})})).catch((()=>{this.$message({type:"info",message:"取消输入"})}))},remove(e,i){let a=this,o="";if(this.colData.rightButtonList.forEach((e=>{"delete"==e.name&&(o=e)})),!o.pageData.api)return!1;var n="",d=new Object;if(o.pageData.apiSuffix){let e=o.pageData.apiSuffix;for(let t of e)n=n+"/"+i[t]}else n="/"+i.id;if(o.pageData.querySuffix){let e=o.pageData.querySuffix;for(let t of e)1==t[2]?d[t[0]]=t[1]:d[t[0]]=i[t[1]]}this.$confirm(o.pageData.content,o.pageData.title,{confirmButtonText:o.pageData.okText,cancelButtonText:o.pageData.cancelText,dangerouslyUseHTMLString:!0,closeOnClickModal:!1,type:"warning"}).then((async()=>{let s=o.pageData.api+n;""!=t.stringify(d)&&(s=s+"?"+t.stringify(d));let l=await a.$xyutil.request({url:s,method:o.pageData.formMethod,header:a.header});if("200"==l.code){const t=e.parent,o=t.data.children||t.data,n=o.findIndex((e=>e.id===i.id));if(o.splice(n,1),a.$xyutil.showToast({title:l.msg,icon:"success",duration:1e3}),this.$store.state.app.uiAudio){let e=new Audio;e.src="https://cdn.jsdelivr.net/gh/starideas/xyfront/audio/delete.mp3",e.play()}}else a.$xyutil.showToast({title:l.msg,icon:"loading",duration:3e3})})).catch((()=>{if(this.$store.state.app.uiAudio){let e=new Audio;e.src="https://cdn.jsdelivr.net/gh/starideas/xyfront/audio/close2.mp3",e.play()}}))},readyProcess(e){let t=i.readyList({listData:e},this.$store.state.app.apiInfo);this.colData={...t.listData},this.ready=!0},async loadData(e=""){var t,i;if(""!=e&&(this.api=e),this.loading=!0,this.api){let e=await this.$xyutil.request({url:this.api,method:"get",header:{CloudId:null==(t=this.header)?void 0:t.cloudId,Eid:null==(i=this.header)?void 0:i.eid}});"200"==e.code?(this.readyProcess(e.data.listData),this.id=e.data.id,this.loading=!1):this.$xyutil.showToast({title:e.msg,icon:"loading",duration:3e3})}this.loading=!1}}},d=window.Vue.toDisplayString,s=window.Vue.createElementVNode,l=window.Vue.createTextVNode,r=window.Vue.resolveComponent,c=window.Vue.withCtx,u=window.Vue.createVNode,h=window.Vue.vShow,p=window.Vue.withDirectives,f=window.Vue.resolveDirective,m=window.Vue.openBlock,g=window.Vue.createElementBlock;window.Vue.pushScopeId,window.Vue.popScopeId;const y={class:"xy-builder-comp xy-builder-wrap-col"},x={class:"col-box"},w={class:"custom-tree-node flex flex-1 flex-alignCenter","slot-scope":"{ node, data }"},D={class:"actions ts-13",style:{display:"none"}},_={id:"contextmenu",class:"menu"};const v=a(n,[["render",function(e,t,i,a,o,n){const v=r("el-link"),b=r("el-tree"),I=r("el-button"),V=r("el-col"),C=r("XyBuilderForm"),E=r("el-row"),k=f("loading");return m(),g("div",y,[p((m(),g("div",x,[u(E,{gutter:25},{default:c((()=>[u(V,{xs:24,sm:24,md:6,lg:4,class:"left m-b-md"},{default:c((()=>[u(b,{class:"",data:o.colData.dataList,"node-key":"id","default-expand-all":"","highlight-current":"",draggable:"",onNodeContextmenu:n.handleContextmenu,onNodeDrop:n.handleDrop,"expand-on-click-node":!0},{default:c((()=>[s("div",w,[s("div",{class:"flex-1 ts-14 tw5 flex flex-alignCenter",onClick:t[0]||(t[0]=t=>n.editPre(e.node,e.data))},d(e.data.title),1),s("div",D,[u(v,{class:"m-r-xs",type:"text",onClick:t[1]||(t[1]=()=>n.append(e.node,e.data))},{default:c((()=>[l(" 添加子项 ")])),_:1}),u(v,{type:"danger",onClick:t[2]||(t[2]=()=>n.remove(e.node,e.data))},{default:c((()=>[l(" 删除 ")])),_:1})])])])),_:1},8,["data","onNodeContextmenu","onNodeDrop"]),u(I,{class:"full",type:"text",onClick:t[3]||(t[3]=()=>n.append())},{default:c((()=>[l(" 添加 ")])),_:1}),p(s("div",_,[s("div",{class:"contextmenu__item",onClick:t[4]||(t[4]=()=>n.append(o.cnode,o.cdata))},"添加子项"),s("div",{class:"contextmenu__item",onClick:t[5]||(t[5]=()=>n.remove(o.cnode,o.cdata))},"删除")],512),[[h,o.menuVisible]])])),_:1}),u(V,{xs:24,sm:24,md:18,lg:20,class:"right"},{default:c((()=>[u(C,{ref:"rightForm",api:o.currentEditApi,show:!0,header:i.header,onClose:t[6]||(t[6]=e=>n.closeModel(e))},null,8,["api","header"])])),_:1})])),_:1})])),[[k,o.loading]])])}],["__scopeId","data-v-97600590"]]),b=Object.freeze(Object.defineProperty({__proto__:null,default:v},Symbol.toStringTag,{value:"Module"}));export{v as X,b as _};
