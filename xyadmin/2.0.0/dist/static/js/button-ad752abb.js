import{_ as e}from"./preload-helper-17f83b6a.js";import{l as a}from"./index-653e326b.js";const t={name:"button",data:()=>({}),created:function(){},mounted:async function(){},methods:{async goPage(e,t){let i=this,s=e.extra;s.pageData.hasOwnProperty("pageType")||(s.pageData.pageType="modal");let r="";var p="",o=new Object;if(t){if(s.pageData.apiSuffix){let e=s.pageData.apiSuffix;for(let a of e)a.field?a.noSlash?p+=t.row[a.field]:p=p+"/"+t.row[a.field]:p=p+"/"+t.row[a]}else p="/"+t.row.id;if(s.pageData.apiParams&&(p=s.pageData.apiParams+p),s.pageData.querySuffix){let e=s.pageData.querySuffix;for(let a of e)1==a[2]?o[a[0]]=a[1]:o[a[0]]=t.row[a[1]]}r=p;let e="";e="string"!=typeof s.pageData.queryParams?a.stringify(s.pageData.queryParams):0==s.pageData.queryParams.indexOf("?")?s.pageData.queryParams.substr(1):s.pageData.queryParams,e?(r=r+"?"+e,a.stringify(o)&&(r=r+"&"+a.stringify(o))):a.stringify(o)&&(r=r+"?"+a.stringify(o)),s.pageData.querySuffixParse=o}switch(this.currentItem.pageData.modalType=s.pageData.modalType,s.pageData.title&&(this.currentItem.pageData.title=s.pageData.title),s.pageData.modalType){case"table":case"html":case"htmls":this.currentItem.pageData.width=s.pageData.width,this.currentItem.pageData.apiBlank=s.pageData.api+r,this.currentItem.pageData.predata=s.pageData.predata,this.currentItem.pageData.show=!0;break;case"url":window.open(s.pageData.url+r);break;case"confirm":if(this.$store.state.app.uiAudio){let e=new Audio;e.src="https://cdn.jsdelivr.net/gh/starideas/xyfront/audio/open2.mp3",e.play()}this.$confirm(s.pageData.content,s.pageData.title,{confirmButtonText:s.pageData.okText,cancelButtonText:s.pageData.cancelText,dangerouslyUseHTMLString:!0,closeOnClickModal:!1,type:"warning"}).then((async()=>{let e=s.pageData.api+p;""!=a.stringify(o)&&(e=e+"?"+a.stringify(o));let t=await i.$xyutil.request({url:e,method:s.pageData.formMethod,header:i.header});if("200"==t.code){if(i.$xyutil.showToast({title:t.msg,icon:"success",duration:1e3}),this.$store.state.app.uiAudio){let e=new Audio;e.src="https://cdn.jsdelivr.net/gh/starideas/xyfront/audio/delete.mp3",e.play()}s.pageData.noRefresh||i.loadData()}else i.$xyutil.showToast({title:t.msg,icon:"loading",duration:3e3})})).catch((()=>{if(this.$store.state.app.uiAudio){let e=new Audio;e.src="https://cdn.jsdelivr.net/gh/starideas/xyfront/audio/close2.mp3",e.play()}}));break;default:switch(this.pitem.pageData&&"modal"==this.pitem.pageData.pageType&&(s.pageData.pageType=this.pitem.pageData.pageType),s.pageData.pageType){case"replace":this.$router.replace({path:s.pageData.route+"/"+t.row.name});break;case"page":let e="";this.$store.state.menu.menuList.menuTree[this.$store.state.menu.currentSite].routePrefix&&(e=this.$store.state.menu.menuList.menuTree[this.$store.state.menu.currentSite].routePrefix),this.$router.push({path:e+"/pages"+s.pageData.api+p,query:o});break;case"modal":this.currentItem.pageData.width=s.pageData.width,this.currentItem.pageData.apiBlank=s.pageData.api+r,this.currentItem.pageData.show=!0;break;default:alert("未指定按钮pageType")}}},topButtonModal(e){var t;let i=this,s=this.listData.topButtonList[e],r={};if(s.pageData.querySuffix){let e=s.pageData.querySuffix;for(let a of e)1==a[2]?r[a[0]]=a[1]:"id"==a[1]&&(this.currentSelecteds?r[a[0]]=this.currentSelecteds.join(","):alert("请勾选操作项目"))}let p=s.pageData.apiParams,o="";switch(o="string"!=typeof s.pageData.queryParams?a.stringify(s.pageData.queryParams):0==s.pageData.queryParams.indexOf("?")?s.pageData.queryParams.substr(1):s.pageData.queryParams,o?(p=p+"?"+o,a.stringify(r)&&(p=p+"&"+a.stringify(r))):a.stringify(r)&&(p=p+"?"+a.stringify(r)),s.pageData.querySuffixParse=r,s.pageData.modalType){case"url":window.open(s.pageData.url+p);break;case"confirm":if(this.$store.state.app.uiAudio){let e=new Audio;e.src="https://cdn.jsdelivr.net/gh/starideas/xyfront/audio/open2.mp3",e.play()}let e=this,a={};1==(null==(t=s.pageData)?void 0:t.postData)&&"get"!=s.pageData.formMethod&&(p=s.pageData.apiParams,a=r),this.$confirm(s.pageData.content,s.pageData.title,{confirmButtonText:s.pageData.okText,cancelButtonText:s.pageData.cancelText,dangerouslyUseHTMLString:!0,closeOnClickModal:!1,type:"warning"}).then((async()=>{var t,i;let r=await e.$xyutil.request({url:s.pageData.api+p,method:s.pageData.formMethod,data:a,header:{CloudId:e.cloudId,Eid:e.eid}});if("200"==r.code){if((null==(t=r.data)?void 0:t.url)?window.open(null==(i=r.data)?void 0:i.url):e.$Message.success(r.msg),this.$store.state.app.uiAudio){let e=new Audio;e.src="https://cdn.jsdelivr.net/gh/starideas/xyfront/audio/delete.mp3",e.play()}s.pageData.noRefresh||e.loadData()}else e.$xyutil.showToast({title:r.msg,icon:"error",duration:2e3})})).catch((()=>{if(this.$store.state.app.uiAudio){let e=new Audio;e.src="https://cdn.jsdelivr.net/gh/starideas/xyfront/audio/close2.mp3",e.play()}}));break;default:switch(this.pitem.pageData&&"modal"==this.pitem.pageData.pageType&&(s.pageData.pageType=this.pitem.pageData.pageType),s.pageData.pageType){case"page":let e="";this.$store.state.menu.menuList.menuTree[this.$store.state.menu.currentSite].routePrefix&&(e=this.$store.state.menu.menuList.menuTree[this.$store.state.menu.currentSite].routePrefix),this.$router.push({path:e+"/pages"+s.pageData.api+p});break;case"modal":s.pageData.apiBlank=s.pageData.api+p,s.pageData.show=!0}}i.$nextTick((function(){"auto"!==s.pageData.height&&(i.$refs["top_modal_"+s.name][0].$el.querySelector(".el-dialog").querySelector(".el-dialog__body").style.overflowY="scroll",i.$refs["top_modal_"+s.name][0].$el.querySelector(".el-dialog").querySelector(".el-dialog__body").style.height=s.pageData.height)}))},async rightButtonModal(e,t,i){let s=this,r=this.listData.rightButtonList[e];var p="",o=new Object;if(r.pageData.apiSuffix){let e=r.pageData.apiSuffix;for(let a of e)a.field?a.noSlash?p+=t.row[a.field]:p=p+"/"+t.row[a.field]:p=p+"/"+t.row[a]}else p="/"+t.row.id;if(r.pageData.apiParams&&(p=r.pageData.apiParams+p),r.pageData.querySuffix){let e=r.pageData.querySuffix;for(let a of e)1==a[2]?o[a[0]]=a[1]:o[a[0]]=t.row[a[1]]}let n=p,l="";if(l="string"!=typeof r.pageData.queryParams?a.stringify(r.pageData.queryParams):0==r.pageData.queryParams.indexOf("?")?r.pageData.queryParams.substr(1):r.pageData.queryParams,l?(n=n+"?"+l,a.stringify(o)&&(n=n+"&"+a.stringify(o))):a.stringify(o)&&(n=n+"?"+a.stringify(o)),r.pageData.querySuffixParse=o,"replace"==r.pageData.pageType)this.$router.replace({path:r.pageData.route+"/"+t.row.name});else switch(r.pageData.modalType){case"url":window.open(r.pageData.url+n);break;case"confirm":if(this.$store.state.app.uiAudio){let e=new Audio;e.src="https://cdn.jsdelivr.net/gh/starideas/xyfront/audio/open2.mp3",e.play()}this.$confirm(r.pageData.content,r.pageData.title,{confirmButtonText:r.pageData.okText,cancelButtonText:r.pageData.cancelText,dangerouslyUseHTMLString:!0,closeOnClickModal:!1,type:"warning"}).then((async()=>{var e,a;let t=await s.$xyutil.request({url:r.pageData.api+n,method:r.pageData.formMethod,header:s.header});if("200"==t.code){if((null==(e=t.data)?void 0:e.url)?window.open(null==(a=t.data)?void 0:a.url):s.$xyutil.showToast({title:t.msg,icon:"success",duration:1e3}),this.$store.state.app.uiAudio){let e=new Audio;e.src="https://cdn.jsdelivr.net/gh/starideas/xyfront/audio/delete.mp3",e.play()}t.data.updateMenu&&await this.getMenu([]),r.pageData.noRefresh||s.loadData()}else s.$xyutil.showToast({title:t.msg,icon:"loading",duration:3e3})})).catch((()=>{if(this.$store.state.app.uiAudio){let e=new Audio;e.src="https://cdn.jsdelivr.net/gh/starideas/xyfront/audio/close2.mp3",e.play()}}));break;default:switch(this.pitem.pageData&&"modal"==this.pitem.pageData.pageType&&(r.pageData.pageType=this.pitem.pageData.pageType),r.pageData.pageType){case"page":let e="";this.$store.state.menu.menuList.menuTree[this.$store.state.menu.currentSite].routePrefix&&(e=this.$store.state.menu.menuList.menuTree[this.$store.state.menu.currentSite].routePrefix),this.$router.push({path:e+"/pages"+r.pageData.api+p,query:o});break;case"modal":r.pageData.apiBlank=r.pageData.api+n,r.pageData.show=!0;break;default:alert("未指定按钮pageType")}}s.$nextTick((function(){"auto"!==r.pageData.height&&(s.$refs["right_modal_"+r.name][0].$el.querySelector(".el-dialog").querySelector(".el-dialog__body").style.overflowY="scroll",s.$refs["right_modal_"+r.name][0].$el.querySelector(".el-dialog").querySelector(".el-dialog__body").style.height=r.pageData.height)}))},async getMenu(a=[]){const t=this.$message({message:"加载左侧导航菜单信息",duration:5e3});var i=[{path:"/",name:"root",redirect:"/home",meta:{title:"首页"},component:adminLayout,children:[{path:"/home",name:"home",meta:{title:"首页"},component:()=>e((()=>import("./home-3c0f8c6e.js")),["static/js/home-3c0f8c6e.js","static/js/_plugin-vue_export-helper-1b428a4d.js","static/css/home-d098ad8f.css"])}]}];a.menuTree||(a={menuTree:[],menuList:[]});let s=this;if(!a.menuTree[0]){if(!this.$store.state.app.apiInfo.api.apiMenuTrees)return void alert("基础接口信息错误");let e=await this.$xyutil.request({url:this.$store.state.app.apiInfo.api.apiBase+this.$store.state.app.apiInfo.api.apiMenuTrees,method:"get"});if("200"==e.code){let t=[];if(e.data.menu2routes)t=treeToList(e.data.listData.dataList,"children");else{treeToList(e.data.listData.dataList,"children");let a=await this.$xyutil.request({url:this.$store.state.app.apiInfo.api.apiBase+this.$store.state.app.apiInfo.api.apiMenuLists,method:"get"});if("200"!=a.code)return alert(e.msg),!1;t=a.data.dataList}a={menuTree:e.data.listData.dataList,menuList:t},s.$store.dispatch("menu/setMenuList",a);let r=s.util.addMenuRoutes(a,this.$store.state.app.apiInfo);r&&(i[0].children=r),s.$router.addRoutes(i)}}t.close()}}};export{t as b};
