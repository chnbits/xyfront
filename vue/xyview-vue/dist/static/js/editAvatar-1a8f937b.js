var e=(e,t,o)=>new Promise(((i,a)=>{var r=e=>{try{n(o.next(e))}catch(t){a(t)}},l=e=>{try{n(o.throw(e))}catch(t){a(t)}},n=e=>e.done?i(e.value):Promise.resolve(e.value).then(r,l);n((o=o.apply(e,t)).next())}));import{_ as t,b as o}from"../../index.js";const i={name:"editAvatar",props:{showPopup:!1},data:()=>({loading:!1,filename:"",avatarURL:"",previews:{},option:{img:"",info:!0,outputSize:1,full:!0,outputType:"png",canMove:!0,original:!1,canMoveBox:!0,autoCrop:!0,autoCropWidth:150,autoCropHeight:150,fixed:!0,fixedBox:!0}}),created:function(){return e(this,null,(function*(){o((()=>Promise.resolve({})),["static/css/index-193d3e82.css"]),this.option.img=this.$store.state.user.userInfo.avatar,this.filename=this.guid()+".png"}))},components:{"vue-cropper":(0,window.Vue.defineAsyncComponent)((()=>new Promise(((e,t)=>{o((()=>import("./vue-cropper.es-29a2d1f5.js")),[]).then((t=>{e(t.VueCropper)}))}))))},methods:{guid:()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),saveEditAvatar(){this.finish("blob")},changeScale(e){e=e||1,this.$refs.cropper.changeScale(e)},rotateLeft(){this.$refs.cropper.rotateLeft()},rotateRight(){this.$refs.cropper.rotateRight()},finish(t){this.loading=!0,"blob"===t?this.$refs.cropper.getCropBlob((t=>e(this,null,(function*(){let e=yield this.$xyutil.uploadFile({driver:this.$store.state.app.uploadDriver,header:{token:this.$xyutil.config.getToken()},blobInfo:{blob:()=>t,filename:this.filename}});e.data?(this.avatarURL=e.data.url,this.submit()):this.$util.showToast({title:"上传失败",icon:"loading",duration:3e3}),this.loading=!1})))):this.$refs.cropper.getCropData((e=>{}))},realTime(e){this.previews=e},down(e){var t=document.createElement("a");t.download="author-img","blob"===e?this.$refs.cropper.getCropBlob((e=>{t.href=window.URL.createObjectURL(e),t.click()})):this.$refs.cropper.getCropData((e=>{t.href=e,t.click()}))},uploadImg(e){var t=this;this.filename=e.name;var o=new FileReader;o.onload=e=>{let o;o="object"==typeof e.target.result?window.URL.createObjectURL(new Blob([e.target.result])):e.target.result,t.option.img=o},o.readAsArrayBuffer(e.raw)},submit(){return e(this,null,(function*(){if(!this.avatarURL)return;let e=yield this.$util.request({url:"/v1/core/user/avatar",data:{avatar:this.avatarURL},method:"put"});200==e.code?(this.$store.state.user.userInfo.avatar=this.avatarURL,this.$util.showToast({title:e.msg,icon:"success",duration:2e3}),this.$router.back(-1),this.showPopup=!1):this.$util.showToast({title:e.msg,icon:"loading",duration:3e3})}))}}},a=window.Vue.createTextVNode,r=window.Vue.resolveComponent,l=window.Vue.withCtx,n=window.Vue.createVNode,s=window.Vue.createElementVNode,c=window.Vue.normalizeStyle,p=window.Vue.openBlock,u=window.Vue.createElementBlock,d=window.Vue.pushScopeId,h=window.Vue.popScopeId,x=e=>(d("data-v-31ca08aa"),e=e(),h(),e),f={class:"bg-white p-a"},m={class:"p-t"},w={class:"cropper text-center m-b-lg"},v=x((()=>s("span",{class:"text-gray ts-14"},[s("i",{class:"xyicon xyicon-help-o ts-14"}),a(" 滚动鼠标滚轮以缩放图片 ")],-1))),g={class:"preview-box"},y=["src"],b=x((()=>s("br",null,null,-1))),C={class:"m-t-md flex flex-end p-r-md"};const _=t(i,[["render",function(e,t,o,i,d,h){const x=r("el-breadcrumb-item"),_=r("el-breadcrumb"),k=r("vue-cropper"),R=r("el-col"),V=r("el-button"),$=r("el-upload"),T=r("el-row");return p(),u("div",f,[s("div",m,[n(_,{"separator-class":"el-icon-arrow-right",class:"p-l m-b"},{default:l((()=>[n(x,{to:{path:"/user/center"}},{default:l((()=>[a("个人设置")])),_:1}),n(x,null,{default:l((()=>[a("修改头像")])),_:1})])),_:1})]),n(T,{gutter:60},{default:l((()=>[n(R,{xs:24,sm:24,md:12,offset:0},{default:l((()=>[s("div",w,[n(k,{ref:"cropper",class:"m-b",img:d.option.img,outputSize:d.option.size,outputType:d.option.outputType,info:d.option.info,full:d.option.full,canMove:d.option.canMove,canMoveBox:d.option.canMoveBox,original:d.option.original,autoCrop:d.option.autoCrop,autoCropWidth:d.option.autoCropWidth,autoCropHeight:d.option.autoCropHeight,fixedBox:d.option.fixedBox,onRealTime:h.realTime},null,8,["img","outputSize","outputType","info","full","canMove","canMoveBox","original","autoCrop","autoCropWidth","autoCropHeight","fixedBox","onRealTime"]),v])])),_:1}),n(R,{xs:24,sm:24,md:12,offset:0},{default:l((()=>[s("div",g,[s("div",{class:"show-preview",style:c({width:d.previews.w+"px",height:d.previews.h+"px",overflow:"hidden",margin:"5px"})},[s("div",{style:c(d.previews.div),class:"preview"},[s("img",{src:d.previews.url,style:c([d.previews.img,{"max-width":"none"}])},null,12,y)],4)],4),n(T,{class:"m-t-md m-b",type:"flex",justify:"center"},{default:l((()=>[n($,{action:"","show-file-list":!1,"auto-upload":!1,"on-change":h.uploadImg},{default:l((()=>[n(V,{size:"small",type:"primary"},{default:l((()=>[a(" 上传新头像 ")])),_:1})])),_:1},8,["on-change"])])),_:1}),b,n(T,null,{default:l((()=>[n(V,{class:"xyicon xyicon-plus",circle:"",size:"small",onClick:t[0]||(t[0]=e=>h.changeScale(1))}),n(V,{class:"xyicon xyicon-minus",circle:"",size:"small",onClick:t[1]||(t[1]=e=>h.changeScale(-1))}),n(V,{class:"xyicon xyicon-download",circle:"",size:"small",onClick:t[2]||(t[2]=e=>h.down("blob"))}),n(V,{class:"xyicon xyicon-left",circle:"",size:"small",onClick:h.rotateLeft},null,8,["onClick"]),n(V,{class:"xyicon xyicon-right",circle:"",size:"small",onClick:h.rotateRight},null,8,["onClick"])])),_:1})])])),_:1})])),_:1}),s("div",C,[n(V,{onClick:t[3]||(t[3]=e=>o.showPopup=!1)},{default:l((()=>[a("取消")])),_:1}),n(V,{type:"primary",onClick:h.saveEditAvatar},{default:l((()=>[a("保存")])),_:1},8,["onClick"])])])}],["__scopeId","data-v-31ca08aa"]]);export{_ as default};
