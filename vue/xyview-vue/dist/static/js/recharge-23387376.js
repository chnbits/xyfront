var e=(e,t,l)=>new Promise(((a,o)=>{var i=e=>{try{n(l.next(e))}catch(t){o(t)}},r=e=>{try{n(l.throw(e))}catch(t){o(t)}},n=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,r);n((l=l.apply(e,t)).next())}));import{p as t}from"./getRet-09ca08b6.js";import{_ as l}from"../../index.js";const a={name:"Recharge",mixins:[t],data(){var e,t,l;return{loading:!1,agree:!1,balance:null==(l=null==(t=null==(e=this.$store.state.user.userInfo)?void 0:e.moduleExtend)?void 0:t.user_score[1])?void 0:l.balance,scoreList:[],form:{money:"0.01",payType:""},rules:{money:[{required:!0,message:"请输入充值金额",trigger:"blur"}],payType:[{required:!0,message:"请选择支付方式"}]},payTypeSubIndex:0,orderInfo:[],orderSets:{totalMoney:0,realMoney:0},tradeNo:"",payDialog:!1,payTypeList:[{title:"支付宝",value:"alipay",icon:"xyicon-alipay",color:"#07b4fd",check:!0},{title:"微信支付",value:"wxpay",icon:"xyicon-wxpay",color:"#51b100",check:!1}],bankList:[{name:"中国银行",logo:"https://vkceyugu.cdn.bspapp.com/VKCEYUGU-f12e1180-fce8-465f-a4cd-9f2da88ca0e6/376ae143-b854-4561-bdf2-054307feb2f8.png"}]}},created(){this.loadBalance()},methods:{goBack(){this.$router.back()},loadBalance(){return e(this,null,(function*(){let e=yield this.$util.request({url:"/v1/user_score/score/my",data:{typeId:1},method:"get"});200==e.code?(this.scoreList=e.data.dataList,this.balance=this.scoreList[1].balance):this.$util.showToast({title:e.msg,icon:"loading",duration:3e3})}))},getPayResult(){},submit(){return e(this,null,(function*(){let t=this;this.$refs.form.validate((l=>e(this,null,(function*(){if(!l)return!1;{if(!this.agree)return this.$util.showToast({title:"请勾选提示表示同意",icon:"loading",duration:3e3}),!1;this.loading=!0;let e=yield this.$util.request({url:"/v1/order/order/submit",data:{oneOrder:1,orderInfo:[{spuId:1,skuId:0,amount:this.form.money/1,extra:{typeId:1}}],extra:{module:"user_score",service:"score",payType:this.form.payType,payPlatform:"pc"}},method:"post"});if(this.loading=!1,200!=e.code)return void this.$util.showToast({title:e.msg,icon:"loading",duration:3e3});this.tradeNo=e.data.tradeNo,this.orderSets=e.data.orderSets,this.payDialog=!0,this.timer=setInterval((function(){t.getPayResult(t.tradeNo)}),3e3),e.data.isRedirect?window.open(e.data.payString,"_blank"):window.open("/pay/order/qrpay?realMoney="+this.orderSets.realMoney+"&payType="+this.form.payType+"&tradeNo="+this.tradeNo+"&payString="+e.data.payString,"_blank")}}))))}))}}},o=window.Vue.createTextVNode,i=window.Vue.resolveComponent,r=window.Vue.withCtx,n=window.Vue.createVNode,s=window.Vue.createElementVNode,d=window.Vue.toDisplayString,u=window.Vue.normalizeClass,c=window.Vue.normalizeStyle,p=window.Vue.renderList,m=window.Vue.Fragment,y=window.Vue.openBlock,f=window.Vue.createElementBlock,h=window.Vue.createCommentVNode,b={class:"box"},w={class:"p-t"},g={class:"content"},v={class:"p-t p-b p-l p-r flex space-between flex-alignCenter"},k={class:"m-r"},x={class:"ts-18"},V=s("p",null,null,-1),_={key:0},T=["onClick"],I=["src"],C={key:0,class:"checkIcon"},S=s("ul",null,[s("li",null,"支付未到账请先确认第三方支付平台账单已支付成功；"),s("li",null,"如果确认自己已经付款，余额却未到账，请联系客服核实。")],-1),$={slot:"footer"};const N=l(a,[["render",function(e,t,l,a,N,L){const q=i("el-breadcrumb-item"),B=i("el-breadcrumb"),U=i("el-form-item"),D=i("el-input"),M=i("xy-choose"),P=i("el-checkbox"),R=i("el-button"),E=i("el-form"),z=i("el-descriptions-item"),j=i("el-descriptions"),A=i("el-alert"),F=i("el-dialog");return y(),f("div",b,[s("div",w,[n(B,{"separator-class":"el-icon-arrow-right",class:"p-l m-b"},{default:r((()=>[n(q,{to:{path:"/user/center"}},{default:r((()=>[o("个人设置")])),_:1}),n(q,null,{default:r((()=>[o("余额充值")])),_:1})])),_:1})]),s("div",g,[n(E,{model:N.form,rules:N.rules,ref:"form","label-width":"120px","label-suffix":":",inline:!1,size:"normal"},{default:r((()=>[n(U,{label:"当前账号"},{default:r((()=>[s("span",null,d(e.$store.state.user.userInfo.nickname)+"（id:"+d(e.$store.state.user.userInfo.id)+"）",1)])),_:1}),n(U,{label:"当前余额"},{default:r((()=>[o(" ¥"),s("span",null,d(N.balance),1)])),_:1}),n(U,{prop:"money",label:"充值金额"},{default:r((()=>[n(D,{style:{width:"220px"},modelValue:N.form.money,"onUpdate:modelValue":t[0]||(t[0]=e=>N.form.money=e),placeholder:"请输入充值金额"},null,8,["modelValue"])])),_:1}),n(U,{prop:"payType",label:"支付方式",required:""},{default:r((()=>[n(M,{options:N.payTypeList,modelValue:N.form.payType,"onUpdate:modelValue":t[1]||(t[1]=e=>N.form.payType=e)},{default:r((e=>[s("div",v,[s("div",k,[s("i",{class:u("ts-32 xyicon "+e.icon),style:c({color:e.color})},null,6)]),s("div",null,[s("h5",x,d(e.title),1),V])])])),_:1},8,["options","modelValue"]),"bank"==N.form.payType?(y(),f("div",_,[(y(!0),f(m,null,p(N.bankList,((e,t)=>(y(),f("div",{class:u(["bank-choose m-t m-b",{borderActive:t==N.payTypeSubIndex}]),key:t,onClick:e=>N.payTypeSubIndex=t},[s("img",{src:e.logo,alt:""},null,8,I),e.check?(y(),f("span",C)):h("",!0)],10,T)))),128))])):h("",!0)])),_:1}),n(U,{label:""},{default:r((()=>[n(P,{modelValue:N.agree,"onUpdate:modelValue":t[2]||(t[2]=e=>N.agree=e)},null,8,["modelValue"]),o(" 账户余额可用来在"+d(e.$store.state.app.siteInfo.title)+"支付各种类型的产品或者服务。 ",1)])),_:1}),n(U,{class:"m-t-md"},{default:r((()=>[n(R,{type:"primary",onClick:L.submit,disabled:!N.agree},{default:r((()=>[o("立即充值")])),_:1},8,["onClick","disabled"]),n(R,{onClick:L.goBack},{default:r((()=>[o("取消")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model","rules"])]),n(F,{title:"提示",visible:N.payDialog,"onUpdate:visible":t[5]||(t[5]=e=>N.payDialog=e),width:"600px"},{default:r((()=>[n(j,{title:"",column:1},{default:r((()=>[n(z,{label:"充值方式"},{default:r((()=>[o(d(N.form.payType),1)])),_:1}),n(z,{label:"充值金额"},{default:r((()=>[o(d(N.orderSets.totalMoney),1)])),_:1})])),_:1}),n(A,{title:"提示",type:"warning",effect:"light","show-icon":"",closable:!1,class:"lh-1-6 m-t-md"},{default:r((()=>[S])),_:1}),s("span",$,[n(R,{type:"danger",onClick:t[3]||(t[3]=t=>e.$util.showToast({title:"请联系客服解决",icon:"loading",duration:5e3}))},{default:r((()=>[o("支付遇到问题")])),_:1}),n(R,{type:"success",onClick:t[4]||(t[4]=t=>e.$router.push({path:"/user/center"}))},{default:r((()=>[o("支付成功")])),_:1})])])),_:1},8,["visible"])])}]]);export{N as default};
