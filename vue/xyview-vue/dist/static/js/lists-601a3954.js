var t=(t,e,a)=>new Promise(((s,i)=>{var l=t=>{try{o(a.next(t))}catch(e){i(e)}},n=t=>{try{o(a.throw(t))}catch(e){i(e)}},o=t=>t.done?s(t.value):Promise.resolve(t.value).then(l,n);o((a=a.apply(t,e)).next())}));import{_ as e}from"../../index.js";const a={name:"commentLists",props:{allowZan:{type:Boolean,default:!1},allowLike:{type:Boolean,default:!1},showReplyForm:{type:Boolean,default:!1},title:{type:String,default:"评论"},dataId:{type:[Number,String],default:0},dataModel:{type:String,default:""},urlPrefix:{type:String,default:""}},data(){return{loading:!1,dataList:[],item:{extra:{tinymce:{height:300,toolbar:"formatselect fontsizeselect | link image media blockquote codesample | bold italic underline strikethrough | forecolor backcolor bullist numlist | code fullscreen | newyear"}}},replyTarget:"",comment:{anonymous:0,tpid:0,tpidIndex:-1,pid:0,dataId:0,dataModel:this.dataModel,content:"",images:[],url:""}}},created:function(){this.comment.dataId=this.dataId,this.loadData()},watch:{dataId(t){this.comment.dataId=this.dataId,this.loadData()},dataModel(t){this.loadData()}},methods:{doreply(t,e="",a=-1){a>=0&&(this.comment.tpidIndex=a,this.comment.tpid=this.dataList[a].id),this.comment.dataId=this.dataId,this.comment.pid=t,this.showReplyForm=!0,this.replyTarget=e},reply(){return t(this,null,(function*(){if(this.comment.url=this.urlPrefix+"/"+this.comment.dataId,!this.comment.content)return this.$util.showToast({title:"请填写回复",icon:"error",duration:2e3}),!1;let t=yield this.$util.request({url:"/v1/comment/comment/add",method:"post",data:this.comment,header:{}});200==t.code?(this.$util.showToast({title:"提交成功",icon:"none",duration:2e3}),this.$emit("update:showReplyForm",!1),t.data.comment.userInfo=this.$store.state.user.userInfo,this.comment.tpid>0?this.dataList[this.comment.tpidIndex].children.push(t.data.comment):this.dataList.push(t.data.comment),this.replyTarget="",this.comment={anonymous:0,tpid:0,tpidIndex:-1,pid:0,dataId:0,dataModel:this.dataModel,content:"",images:[],url:""}):this.$util.showToast({title:t.msg,icon:"none",duration:2e3})}))},actionClick(e,a,s,i=-1){return t(this,null,(function*(){let t=0;t=-1!=i?this.dataList[e].children[i].id:this.dataList[e].id;let l=yield this.$util.request({url:"/v1/action/action/set",data:{dataId:t,dataModel:a,actionType:s},method:"post"});200==l.code?(-1!=i?this.$set(this.dataList[e].children[i].actionStates,s,l.data.currentValue):this.$set(this.dataList[e].actionStates,s,l.data.currentValue),this.$util.showToast({title:l.msg,icon:"success",duration:2e3})):this.$util.showToast({title:l.msg,icon:"loading",duration:3e3})}))},loadData(){return t(this,null,(function*(){if(!this.dataId||!this.dataModel)return;this.loading=!0;let t=yield this.$util.request({url:"/v1/comment/comment/lists",data:{dataId:this.dataId,dataModel:this.dataModel},method:"get"});200==t.code?(this.dataList=t.data.dataList,0==this.dataList.length&&this.$emit("update:showReplyForm",!0)):this.$util.showToast({title:t.msg,icon:"loading",duration:3e3}),this.loading=!1}))}}},s=window.Vue.resolveComponent,i=window.Vue.createVNode,l=window.Vue.createElementVNode,n=window.Vue.toDisplayString,o=window.Vue.openBlock,d=window.Vue.createElementBlock,r=window.Vue.createCommentVNode,c=window.Vue.createTextVNode,m=window.Vue.withCtx,u=window.Vue.createBlock,h=window.Vue.renderList,p=window.Vue.Fragment,y=window.Vue.normalizeClass,w=window.Vue.resolveDirective,f=window.Vue.withDirectives,g=window.Vue.vShow,x=window.Vue.pushScopeId,v=window.Vue.popScopeId,k=t=>(x("data-v-0325a012"),t=t(),v(),t),I={class:"ts-14"},b={key:0,class:"m-b"},V={class:"user flex space-between"},C={class:"flex"},$={class:"m-r-sm"},L={class:"title tw5 ts-14"},T={class:"info flex space-between text-gray ts-13",style:{"margin-top":"2px"}},_=k((()=>l("div",{class:"ts-12 text-gray"},"写回复",-1))),M={key:1,class:"comment-form"},S={key:0},z={class:"comment-list p-a",style:{"min-height":"70px"},"element-loading-text":"数据加载中"},F={class:"user flex space-between"},D={class:"flex"},B={class:"m-r-sm"},q={class:"bg-white"},N={class:"title tw5 ts-14"},R={class:"info flex space-between text-gray ts-13",style:{"margin-top":"2px"}},H={class:"ts-12 text-gray"},P={class:"content ts-14 m-t-sm"},Z=["innerHTML"],E={key:0,class:"children-list m-l-lg m-t-sm bg-gray-light p-a-sm br-4"},j={class:"flex space-between ts-13"},U={class:"m-b-xs"},A={class:"ts-12 text-gray"},G=["innerHTML"],J={class:"actions flex flex-alignCenter"},K=["onClick"],O=k((()=>l("i",{class:"xyicon xyicon-zan ts-14",style:{"margin-right":"3px"}},null,-1))),Q=["onClick"],W=k((()=>l("i",{class:"xyicon xyicon-reply ts-14",style:{"margin-right":"3px"}},null,-1))),X=["onClick"],Y=k((()=>l("i",{class:"xyicon xyicon-heart ts-14",style:{"margin-right":"3px"}},null,-1))),tt={class:"actions m-t flex flex-alignCenter"},et=k((()=>l("i",{class:"xyicon xyicon-zan ts-14",style:{"margin-right":"3px"}},null,-1))),at=["onClick"],st=k((()=>l("i",{class:"xyicon xyicon-reply ts-14",style:{"margin-right":"3px"}},null,-1))),it=["onClick"],lt=k((()=>l("i",{class:"xyicon xyicon-heart ts-14",style:{"margin-right":"3px"}},null,-1)));const nt=e(a,[["render",function(t,e,a,x,v,k){const nt=s("el-avatar"),ot=s("el-input"),dt=s("el-button"),rt=s("el-alert"),ct=s("el-card"),mt=s("el-tag"),ut=s("el-link"),ht=w("loading");return o(),d("div",I,[a.showReplyForm?(o(),u(ct,{key:0,class:"box-card m-b-sm",shadow:"never"},{default:m((()=>[t.$util.getToken()?(o(),d("div",b,[l("div",V,[l("div",C,[l("div",$,[i(nt,{shape:"square",icon:"el-icon-user-solid",src:t.$store.state.user.userInfo.avatar},null,8,["src"])]),l("div",null,[l("div",L,n(t.$store.state.user.userInfo.nickname),1),l("div",T,[l("div",null,n(t.$store.state.user.userInfo.slogan?t.$store.state.user.userInfo.slogan:""),1)])])]),_])])):r("",!0),t.$util.getToken?(o(),d("div",M,[i(ot,{modelValue:v.comment.content,"onUpdate:modelValue":e[0]||(e[0]=t=>v.comment.content=t),type:"textarea",rows:"4",placeholder:"",size:"default",clearable:""},null,8,["modelValue"]),i(dt,{type:"primary",size:"default",onClick:k.reply,class:"m-t m-b m-r",style:{width:"80px"}},{default:m((()=>[c(" 提交 ")])),_:1},8,["onClick"]),v.replyTarget?(o(),d("span",S,"回复"+n(v.replyTarget),1)):r("",!0)])):r("",!0),t.$util.getToken?r("",!0):(o(),u(rt,{key:2,title:"请登录后回复",type:"error","show-icon":""}))])),_:1})):r("",!0),f(i(ct,{class:"box-card m-b",shadow:"never"},{header:m((()=>[l("span",null,n(a.title)+"列表",1)])),default:m((()=>[f((o(),d("div",z,[(o(!0),d(p,null,h(v.dataList,((e,s)=>(o(),d("div",{class:y(["item p-b-sm border-bottom_1px",s>0?"p-t-sm":""]),key:s},[l("div",F,[l("div",D,[l("div",B,[i(nt,{icon:"el-icon-user-solid",src:e.userInfo.avatar},null,8,["src"])]),l("div",q,[l("div",N,[c(n(e.userInfo.nickname)+" ",1),e.userInfo.roles||1==e.userInfo.id?(o(),u(mt,{key:0,type:"success",size:"small",effect:"dark"},{default:m((()=>[c(" 官方人员 ")])),_:1})):r("",!0)]),l("div",R,[l("div",null,n(e.userInfo.slogan?e.userInfo.slogan:""),1)])])]),l("div",H,n(t.$util.timeFormat(e.createTime)),1)]),l("div",P,[l("div",{innerHTML:e.content},null,8,Z),e.children.length>0?(o(),d("div",E,[(o(!0),d(p,null,h(e.children,((e,h)=>(o(),d("div",{class:"m-b-sm m-t-xs",key:h},[l("div",j,[l("div",U,[l("span",null,n(e.userInfo.nickname),1),e.userInfo.roles||1==e.userInfo.id?(o(),u(mt,{key:0,class:"m-l-xs m-r-xs",type:"success",size:"small",effect:"dark"},{default:m((()=>[c(" 官方人员 ")])),_:1})):r("",!0),c(" 回复 "),l("span",null,n(e.puserInfo?e.puserInfo.nickname:""),1)]),l("div",null,[l("span",A,"回复于"+n(t.$util.timeFormat(e.createTime)),1)])]),l("div",{class:"m-b-sm",innerHTML:e.content},null,8,G),l("div",J,[a.allowZan?(o(),d("div",{key:0,class:"m-r",onClick:t=>k.actionClick(s,"comment",1,h)},[O,i(ut,null,{default:m((()=>[c(n(e.actionStates[1]?"已":"")+"赞同 ",1)])),_:2},1024)],8,K)):r("",!0),l("div",{class:"m-r",onClick:t=>k.doreply(e.id,e.userInfo.nickname,s)},[W,i(ut,null,{default:m((()=>[c(" 回复 ")])),_:1})],8,Q),a.allowLike?(o(),d("div",{key:1,class:"m-r",onClick:t=>k.actionClick(s,"comment",2,h)},[Y,i(ut,null,{default:m((()=>[c(n(e.actionStates[2]?"已":"")+"收藏 ",1)])),_:2},1024)],8,X)):r("",!0)])])))),128))])):r("",!0)]),l("div",tt,[a.allowZan?(o(),u(dt,{key:0,class:"m-r",type:"primary",size:"small",onClick:t=>k.actionClick(s,"comment",1,-1)},{default:m((()=>[et,c(" "+n(e.actionStates[1]?"已":"")+"赞同 ",1)])),_:2},1032,["onClick"])):r("",!0),l("div",{class:"m-r",onClick:t=>k.doreply(e.id,e.userInfo.nickname)},[st,i(ut,null,{default:m((()=>[c(" 回复 ")])),_:1})],8,at),a.allowLike?(o(),d("div",{key:1,class:"m-r",onClick:t=>k.actionClick(s,"comment",2,-1)},[lt,i(ut,null,{default:m((()=>[c(n(e.actionStates[2]?"已":"")+"收藏 ",1)])),_:2},1024)],8,it)):r("",!0)])],2)))),128))])),[[ht,v.loading]])])),_:1},512),[[g,v.dataList.length>0]])])}],["__scopeId","data-v-0325a012"]]);export{nt as c};
