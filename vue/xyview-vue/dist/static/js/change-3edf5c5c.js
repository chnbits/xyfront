var e=(e,l,t)=>new Promise(((i,o)=>{var a=e=>{try{r(t.next(e))}catch(l){o(l)}},s=e=>{try{r(t.throw(e))}catch(l){o(l)}},r=e=>e.done?i(e.value):Promise.resolve(e.value).then(a,s);r((t=t.apply(e,l)).next())}));import{_ as l,v as t}from"../../index.js";const i={mixins:[t],data(){return{active:1,verifyList:[],loading:!1,formVerfyEmail:{email:this.$store.state.user.userInfo.email,verify:"",token:""},form:{email:"",password:"",verify:"",token:"",mobile:"",mobileVerify:"",mobileToken:"",gauth:""},rule:{email:[{required:!0,message:"请填写新邮箱",trigger:"blur"}],verify:[{required:!0,message:"请填写验证码",trigger:"blur"}],token:[{required:!0,message:"请发送验证码",trigger:"blur"}]}}},created:function(){this.loadData()},methods:{verifyPassword(){return e(this,null,(function*(){"200"==(yield this.doVerifyPassword()).code&&this.active++}))},getVerifyTokenVerfyEmail(e){this.formVerfyEmail.token=e.token},verifyEmail(){return e(this,null,(function*(){this.loading=!0;let e=this;setTimeout((function(){e.loading=!1}),5e3);let l=yield this.$util.request({url:"/v1/reg_email/user/verify",data:this.formVerfyEmail,method:"post"});"200"==l.code?(this.$util.showToast({title:l.msg,icon:"success",duration:2e3}),this.active++):this.$util.showToast({title:l.msg,icon:"loading",duration:3e3}),this.loading=!1}))},getVerifyToken(e){this.form.token=e.token},getMobileVerifyToken(e){this.form.mobileToken=e.token},loadData(){return e(this,null,(function*(){let e=yield this.$util.request({url:"/v1/reg_email/user/change",method:"get"});"200"==e.code?this.verifyList=e.data.dataList:this.$util.showToast({title:e.msg,icon:"loading",duration:3e3})}))},handleSubmit(){return e(this,null,(function*(){this.loading=!0;let e=this;setTimeout((function(){e.loading=!1}),5e3);let l=yield this.$util.request({url:"/v1/reg_email/user/change",data:this.form,method:"put"});"200"==l.code?(this.$util.showToast({title:l.msg,icon:"success",duration:2e3}),this.active++):this.$util.showToast({title:l.msg,icon:"loading",duration:3e3}),this.loading=!1}))}}},o=window.Vue.createTextVNode,a=window.Vue.resolveComponent,s=window.Vue.withCtx,r=window.Vue.createVNode,d=window.Vue.createElementVNode,n=window.Vue.openBlock,u=window.Vue.createBlock,m=window.Vue.createCommentVNode,f=window.Vue.createElementBlock,c=window.Vue.pushScopeId,p=window.Vue.popScopeId,y=e=>(c("data-v-e8f46c66"),e=e(),p(),e),h={class:"box"},v={class:"p-t"},V={class:"content p-t-md"},g={class:"step-tabs"},w=y((()=>d("div",{class:"m-b-md ts-18 tw4"},"请输入您的登录密码",-1))),b={class:"m-t-lg"},k=y((()=>d("div",{class:"m-b-md ts-12 tw4",style:{color:"#2A2B2E"}},"为确认您本人操作，需要您进行邮箱验证码验证身份。",-1))),x={class:"flex"},_=y((()=>d("div",{class:"text-gray m-l-md"}," 邮箱不可用？请联系客服。 ",-1))),E={class:"flex"},T={class:"m-t-lg"},z={class:"flex"},C={class:"m-t-lg"},$={key:3},U=y((()=>d("div",null,[d("i",{class:"xyicon xyicon-check3 ts-30 m-r-sm",style:{color:"#4AC711"}}),d("span",{class:"ts-20 tw4",style:{color:"#2A2B2E"}},"换绑邮箱成功。")],-1))),q={class:"m-t-lg"},L=y((()=>d("span",{slot:"title",class:"ts-14"},[d("i",{class:"xyicon xyicon-help-o m-r-xs text-primary"}),d("span",null,"没收到邮箱验证码？")],-1))),P=y((()=>d("div",{class:"lh-2 ts-12 p-l-xs"},[o(" 1、邮箱地址是否填写正确？填写正确的邮箱地址，才能收到验证码邮件。"),d("br"),o(" 2、请核实邮箱邮件是否被拦截，检查邮箱垃圾箱。"),d("br"),o(" 3、如果邮箱已经停用， 请选择其他验证方式 。"),d("br")],-1)));const B=l(i,[["render",function(e,l,t,i,c,p){const y=a("el-breadcrumb-item"),B=a("el-breadcrumb"),N=a("el-step"),A=a("el-steps"),I=a("el-input"),S=a("el-form-item"),O=a("el-button"),D=a("el-link"),M=a("el-form"),j=a("xy-send-verify"),F=a("router-link"),G=a("el-alert");return n(),f("div",null,[d("div",h,[d("div",v,[r(B,{"separator-class":"el-icon-arrow-right",class:"p-l m-b"},{default:s((()=>[r(y,{to:{path:"/user/center"}},{default:s((()=>[o("个人设置")])),_:1}),r(y,null,{default:s((()=>[o("修改邮箱")])),_:1})])),_:1})]),d("div",V,[r(A,{active:c.active,simple:"","align-left":""},{default:s((()=>[r(N,{title:"验证登录密码",description:""}),r(N,{title:"验证旧邮箱",description:""}),r(N,{title:"验证新邮箱",description:""}),r(N,{title:"修改成功",description:""})])),_:1},8,["active"]),d("div",g,[1==c.active?(n(),u(M,{key:0,ref:"formVerifyPassword","label-position":"left","label-width":"0px"},{default:s((()=>[w,r(S,{prop:"password"},{default:s((()=>[r(I,{size:"default",type:"password",prefix:"ios-lock-outline",modelValue:e.password,"onUpdate:modelValue":l[0]||(l[0]=l=>e.password=l),placeholder:"请输入登录密码"},null,8,["modelValue"])])),_:1}),d("div",b,[r(O,{class:"submit-btn primary-linear m-r",size:"default",loading:c.loading,type:"primary",onClick:p.verifyPassword},{default:s((()=>[o(" 下一步 ")])),_:1},8,["loading","onClick"]),r(D,{class:"back ts-14",onClick:l[1]||(l[1]=l=>e.$router.back())},{default:s((()=>[o("取消操作")])),_:1})])])),_:1},512)):m("",!0),2==c.active?(n(),u(M,{key:1,ref:"formVerfyEmail","label-position":"left","label-width":"140px",model:c.formVerfyEmail},{default:s((()=>[k,r(S,{prop:"mobile",label:"请输入旧邮箱"},{default:s((()=>[d("div",x,[r(I,{size:"default",type:"text",prefix:"ios-at-outline",disabled:"",modelValue:c.formVerfyEmail.email,"onUpdate:modelValue":l[2]||(l[2]=e=>c.formVerfyEmail.email=e),placeholder:"请输入旧邮箱"},null,8,["modelValue"]),_])])),_:1}),r(S,{prop:"verify",label:"验证码"},{default:s((()=>[d("div",E,[r(I,{class:"m-r",size:"default",autocomplete:"off",type:"text",prefix:"ios-lock-outline",modelValue:c.formVerfyEmail.verify,"onUpdate:modelValue":l[3]||(l[3]=e=>c.formVerfyEmail.verify=e),placeholder:"请输入邮箱验证码"},null,8,["modelValue"]),r(O,{type:"primary",size:"default"},{default:s((()=>[r(j,{onVerifysuccess:p.getVerifyTokenVerfyEmail,url:"/v1/email/verify/send",type:"邮箱",account:c.formVerfyEmail.email,title:"手机换绑"},null,8,["onVerifysuccess","account"])])),_:1})])])),_:1}),d("div",T,[r(O,{class:"submit-btn primary-linear m-r",size:"default",loading:c.loading,type:"primary",onClick:l[4]||(l[4]=e=>p.verifyEmail())},{default:s((()=>[o(" 下一步 ")])),_:1},8,["loading"]),r(D,{class:"back ts-14",onClick:l[5]||(l[5]=e=>c.active--)},{default:s((()=>[o("返回上一步")])),_:1})])])),_:1},8,["model"])):m("",!0),3==c.active?(n(),u(M,{key:2,ref:"form","label-position":"left","label-width":"140px",model:c.form,rules:c.rule},{default:s((()=>[r(S,{prop:"email",label:"请输入新邮箱号"},{default:s((()=>[r(I,{size:"default",type:"text",prefix:"ios-at-outline",modelValue:c.form.email,"onUpdate:modelValue":l[6]||(l[6]=e=>c.form.email=e),placeholder:"请输入新邮箱号"},null,8,["modelValue"])])),_:1}),r(S,{prop:"verify",label:"验证码"},{default:s((()=>[d("div",z,[r(I,{class:"m-r",size:"default",autocomplete:"off",type:"text",prefix:"ios-lock-outline",modelValue:c.form.verify,"onUpdate:modelValue":l[7]||(l[7]=e=>c.form.verify=e),placeholder:"请输入邮箱验证码"},null,8,["modelValue"]),r(O,{type:"primary",size:"default"},{default:s((()=>[r(j,{onVerifysuccess:p.getVerifyToken,url:"/v1/email/verify/send",type:"邮箱",verifyUser:1,account:c.form.email,title:"邮箱换绑"},null,8,["onVerifysuccess","account"])])),_:1})])])),_:1}),c.verifyList.indexOf("mobile")>=0?(n(),u(S,{key:0,prop:"mobileVerify"},{default:s((()=>[r(I,{size:"large",autocomplete:"off",type:"text",prefix:"ios-lock-outline",modelValue:c.form.mobileVerify,"onUpdate:modelValue":l[8]||(l[8]=e=>c.form.mobileVerify=e),placeholder:"请输入手机验证码"},{append:s((()=>[r(j,{onVerifysuccess:p.getMobileVerifyToken,url:"/v1/sms/verify/send",type:"手机号",noNeedAccount:!0,title:"邮箱换绑"},null,8,["onVerifysuccess"])])),_:1},8,["modelValue"])])),_:1})):m("",!0),c.verifyList.indexOf("gauth")>=0?(n(),u(S,{key:1,prop:"gauth"},{default:s((()=>[r(I,{size:"large",type:"password",prefix:"ios-lock-outline",modelValue:c.form.gauth,"onUpdate:modelValue":l[9]||(l[9]=e=>c.form.gauth=e),placeholder:"请输入谷歌验证码"},null,8,["modelValue"])])),_:1})):m("",!0),c.verifyList.indexOf("password")>=0?(n(),u(S,{key:2,prop:"password"},{default:s((()=>[r(I,{size:"large",type:"password",prefix:"ios-lock-outline",modelValue:c.form.password,"onUpdate:modelValue":l[10]||(l[10]=e=>c.form.password=e),placeholder:"请输入登录密码"},null,8,["modelValue"])])),_:1})):m("",!0),d("div",C,[r(O,{class:"submit-btn primary-linear m-r",size:"default",loading:c.loading,type:"primary",onClick:l[11]||(l[11]=e=>p.handleSubmit("form"))},{default:s((()=>[o(" 确定 ")])),_:1},8,["loading"]),r(D,{class:"back ts-14",onClick:l[12]||(l[12]=e=>c.active--)},{default:s((()=>[o("返回上一步")])),_:1})])])),_:1},8,["model","rules"])):m("",!0),4==c.active?(n(),f("div",$,[U,d("div",q,[r(F,{to:"/user/login"},{default:s((()=>[r(O,{class:"primary-linear",size:"small",type:"primary",round:""},{default:s((()=>[o("重新登录")])),_:1})])),_:1})])])):m("",!0)])]),r(G,{class:"p-l-md p-b",type:"primary"},{default:s((()=>[L,P])),_:1})])])}],["__scopeId","data-v-e8f46c66"]]);export{B as default};
