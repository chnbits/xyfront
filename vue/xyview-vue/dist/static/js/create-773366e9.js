var e=(e,l,t)=>new Promise(((o,s)=>{var a=e=>{try{d(t.next(e))}catch(l){s(l)}},i=e=>{try{d(t.throw(e))}catch(l){s(l)}},d=e=>e.done?o(e.value):Promise.resolve(e.value).then(a,i);d((t=t.apply(e,l)).next())}));import{_ as l}from"../../index.js";const t={data:()=>({orderInfo:[],orderSets:[],addressData:{name:"",tel:"",address:"",city:"",isDefault:0},deliverTypelist:[],deliverType:0,offlineList:[],offlineId:[],tradeNo:"",payTypeList:[{title:"支付宝",value:"alipay",icon:"xyicon-alipay",color:"#07b4fd",check:!0},{title:"微信支付",value:"wxpay",icon:"xyicon-wxpay",color:"#51b100",check:!1},{title:"余额支付",value:"score_1",icon:"xyicon-card",color:"#fec600",check:!1}],form:{payType:""},tradeNo:""}),created(){return e(this,null,(function*(){var e,l;let t=JSON.parse(null==(l=null==(e=this.$route)?void 0:e.query)?void 0:l.data).orderInfo;if(t){let e=yield this.$xyutil.request({url:"/v1/ishop/order/create",method:"post",data:{orderInfo:t}});200==e.code?(this.orderInfo=e.data.orderInfo,this.orderSets=e.data.orderSets):this.$xyutil.showModal({title:"提示",content:e.data.msg,success:function(e){}})}}))},methods:{setAddress(e){this.addressData=e},couponOk(e){this.countMoney()},couponRest(e){this.orderInfo[e].couponIds=new Array,this.toggleMask(e)},selectCoupon(e,l){this.orderInfo[e].couponIds.push(l)},countMoney(){return e(this,null,(function*(){let e=yield this.$xyutil.request({url:"/v1/ishop/order/money",method:"post",data:{orderInfo:this.orderInfo}});200==e.code?this.orderSets=e.data.orderSets:this.$xyutil.showToast({title:e.msg,icon:"loading",duration:1e3})}))},submit(){return e(this,null,(function*(){if(3==this.deliverType&&0==this.offlineId.length)return void this.$util.showToast({title:"请选择门店"});let e=yield this.$xyutil.request({url:"/v1/ishop/order/submit",method:"post",data:{orderInfo:this.orderInfo,extra:{payType:this.form.payType,payPlatform:"pc"}}});if(200!=e.code)return this.loading=!1,void alert(e.msg);this.tradeNo=e.data.tradeNo,this.orderSets=e.data.orderSets,e.data.paySuccess?(this.$util.showToast({title:"支付成功",icon:"success",duration:2e3}),this.$router.push({path:"/ishop/order/my"})):e.data.isRedirect?window.open(e.data.payString,"_blank"):window.open("/pay/order/qrpay?realMoney="+this.info.price+"&payType="+this.form.payType+"&tradeNo="+this.tradeNo+"&payString="+e.data.payString,"_blank")}))}}},o=window.Vue.createElementVNode,s=window.Vue.renderList,a=window.Vue.Fragment,i=window.Vue.openBlock,d=window.Vue.createElementBlock,n=window.Vue.toDisplayString,r=window.Vue.createTextVNode,c=window.Vue.resolveComponent,u=window.Vue.withCtx,p=window.Vue.createBlock,f=window.Vue.createVNode,m=window.Vue.vShow,y=window.Vue.withDirectives,h=window.Vue.createCommentVNode,v=window.Vue.normalizeClass,w=window.Vue.normalizeStyle,x=window.Vue.pushScopeId,V=window.Vue.popScopeId,b=e=>(x("data-v-37af21c4"),e=e(),V(),e),g={class:"container bg-white m-t"},k=b((()=>o("div",{class:"ts-24 tw5 text-center m-b-lg"}," 订单结算 ",-1))),I={class:"p-t p-b p-l p-r flex space-between flex-alignCenter"},_={class:"ts-14"},T={class:"user-address"},S={class:"cen"},C={class:"top"},N={class:"name"},L={class:"mobile"},M={class:"address"},$=b((()=>o("span",{class:"xyicon xyicon-address"},null,-1))),D={class:"yt-list"},U=["onClick"],z={class:"cell-tip active"},q=["onClick"],j={class:"con"},B={class:"left"},O={class:"title"},P={class:"time"},R={class:"right"},A={class:"price"},E=b((()=>o("div",{class:"circle l"},null,-1))),F=b((()=>o("div",{class:"circle r"},null,-1))),J=b((()=>o("text",{class:"tips"},null,-1))),G={key:0},H={key:0},K={key:1},Q={class:"goods-section justify-self-start md:pl-8"},W={class:"m-b flex"},X=["src"],Y={class:"name"},Z=["src"],ee={class:"right flex-1"},le={class:"title clamp m-b-xs"},te={class:"spec m-b-xs text-gray-700"},oe={class:"price-box text-gray-700"},se={class:"price"},ae={class:"number m-l-xs"},ie=b((()=>o("hr",null,null,-1))),de={class:"m-t flex flex-col justify-end items-end"},ne={class:"flex items-center"},re=b((()=>o("h4",{class:"m-r"},"付款方式：",-1))),ce={class:"p-t-sm p-b-sm p-l p-r flex space-between flex-alignCenter"},ue={class:"m-r"},pe={class:"ts-16"},fe=b((()=>o("p",null,null,-1))),me={class:"pay-total"},ye={class:"price-content m-b-sm"},he=b((()=>o("text",null,"实付款",-1))),ve=b((()=>o("text",{class:"price-tip"},"￥",-1))),we={class:"price"};const xe=l(t,[["render",function(e,l,t,x,V,b){const xe=c("el-radio"),Ve=c("el-radio-group"),be=c("el-form-item"),ge=c("xy-choose"),ke=c("el-button"),Ie=c("el-dialog"),_e=c("el-input"),Te=c("el-form"),Se=c("el-col"),Ce=c("el-row");return i(),d("div",g,[k,(i(!0),d(a,null,s(V.orderInfo,((l,t)=>(i(),d("div",{key:t},[f(Ce,{gutter:20},{default:u((()=>[f(Se,{xs:24,span:12,offset:0},{default:u((()=>[f(Te,{ref_for:!0,ref:"form","label-width":"80px",inline:!1,size:"normal"},{default:u((()=>[y(f(be,{label:"配送方式"},{default:u((()=>[f(Ve,{modelValue:l.deliverType,"onUpdate:modelValue":e=>l.deliverType=e,size:"normal"},{default:u((()=>[(i(!0),d(a,null,s(l.deliverTypeList,(e=>(i(),p(xe,{key:e.key,label:e.value},{default:u((()=>[r(n(e.title),1)])),_:2},1032,["label"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1536),[[m,l.deliverTypeList.length>1]]),y(f(be,{label:"选择门店",class:"offline-list"},{default:u((()=>[f(ge,{options:l.offlineList,modelValue:l.offlineId,"onUpdate:modelValue":e=>l.offlineId=e},{default:u((e=>[o("div",I,[o("div",null,[o("h5",_,n(e.city),1),o("p",null,n(e.address),1)])])])),_:2},1032,["options","modelValue","onUpdate:modelValue"])])),_:2},1536),[[m,3==l.deliverType]]),y(f(be,{label:"收货地址",class:"address-section"},{default:u((()=>[o("div",T,[o("div",S,[o("div",C,[o("text",N,n(l.addressData.name),1),o("text",L,n(l.addressData.tel),1)]),o("div",M,[$,r(" "+n(l.addressData.city.join(""))+" "+n(l.addressData.address),1)])])])])),_:2},1536),[[m,l.deliverType<=2]]),f(be,{label:"优惠明细"},{default:u((()=>[o("div",D,[o("div",{class:"yt-list-cell b-b",onClick:e=>{l.couponShow=!0}},[o("text",z," 选择优惠券("+n(l.couponList.length)+") ",1)],8,U)]),f(Ie,{title:"优惠券",modelValue:l.couponShow,"onUpdate:modelValue":e=>l.couponShow=e,width:300},{footer:u((()=>[o("span",null,[f(ke,{size:"small",type:"default",onClick:e=>b.couponRest(l.storeInfo.id)},{default:u((()=>[r("重置")])),_:2},1032,["onClick"]),f(ke,{size:"small",class:"ok",type:"primary",onClick:e=>b.couponOk(l.storeInfo.id)},{default:u((()=>[r("确定")])),_:2},1032,["onClick"])])])),default:u((()=>[(i(!0),d(a,null,s(l.couponList,((t,s)=>(i(),d("div",{onClick:e=>b.selectCoupon(l.storeInfo.id,t.id),class:"coupon-item",key:s},[o("div",j,[o("div",B,[o("text",O,n(t.title),1),o("text",P,"有效期至"+n(e.$xyutil.timeFormat(t.expireTime)),1)]),o("div",R,[o("text",A,n(t.couponValue),1),o("text",null,"满"+n(t.limitMoney)+"可用",1)]),E,F]),J],8,q)))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1024),f(be,{label:"商品金额"},{default:u((()=>[r(" ￥"+n(l.originalMoney),1)])),_:2},1024),f(be,{label:"优惠金额"},{default:u((()=>[l.couponSum>0?(i(),d("span",G,"-")):h("",!0),r(" ￥"+n(l.couponSum),1)])),_:2},1024),f(be,{label:"运费"},{default:u((()=>[0==l.deliverMoney?(i(),d("span",H,"免运费")):(i(),d("span",K,n(l.deliverMoney),1))])),_:2},1024),f(be,{label:"备注"},{default:u((()=>[f(_e,{class:"desc",type:"text",modelValue:l.remark,"onUpdate:modelValue":e=>l.remark=e,placeholder:"请填写备注信息","placeholder-class":"placeholder"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024),f(be)])),_:2},1536)])),_:2},1024),f(Se,{xs:24,span:12,offset:0},{default:u((()=>[o("div",Q,[o("div",W,[o("img",{class:"logo",width:"30",src:l.storeInfo.logo},null,8,X),o("text",Y,n(l.storeInfo.title),1)]),(i(!0),d(a,null,s(l.skuList,((e,l)=>(i(),d("div",{class:"goods-item flex",key:l},[o("img",{width:"70",src:e.itemInfo.cover},null,8,Z),o("div",ee,[o("div",le,n(e.itemInfo.title),1),o("div",te,n(e.spec),1),o("div",oe,[o("span",se,"￥"+n(e.price),1),o("span",ae,"x "+n(e.amount),1)])])])))),128))])])),_:2},1024)])),_:2},1024)])))),128)),ie,o("div",de,[o("div",ne,[re,f(ge,{options:V.payTypeList,modelValue:V.form.payType,"onUpdate:modelValue":l[0]||(l[0]=e=>V.form.payType=e)},{default:u((e=>[o("div",ce,[o("div",ue,[o("i",{class:v("ts-32 xyicon "+e.icon),style:w({color:e.color})},null,6)]),o("div",null,[o("h5",pe,n(e.title),1),fe])])])),_:1},8,["options","modelValue"])]),o("div",me,[o("div",ye,[he,ve,o("text",we,n(V.orderSets.realMoney),1)]),f(ke,{type:"primary",disabled:""!=V.form.payType,class:"submit w-28 m-r-0",size:"large",onClick:b.submit},{default:u((()=>[r("立即付款")])),_:1},8,["disabled","onClick"])])])])}],["__scopeId","data-v-37af21c4"]]);export{xe as default};
