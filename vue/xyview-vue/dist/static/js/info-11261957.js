var e=(e,t,i)=>new Promise(((l,a)=>{var s=e=>{try{d(i.next(e))}catch(t){a(t)}},o=e=>{try{d(i.throw(e))}catch(t){a(t)}},d=e=>e.done?l(e.value):Promise.resolve(e.value).then(s,o);d((i=i.apply(e,t)).next())}));import{_ as t}from"../../index.js";const i=(0,window.Vue.defineComponent)({name:"GoodsComment",props:{itemId:{type:Boolean,defualt:0}},setup:()=>({}),data:()=>({loading:!1,itemId:0,labelList:[{name:"all",title:"全部",count:0}],labelIndex:0,dataList:[],dataPage:{page:1,limit:20,total:0}}),created:function(){this.loadData(0)},watch:{itemId(){this.loadData(0)}},methods:{loadData(t){return e(this,null,(function*(){this.loading=!0;let e=this.labelList[t].name,i=yield this.$xyutil.request({url:"/v1/ishop/comment/lists?itemId="+this.itemId+"&type="+e,method:"get",data:{page:this.dataPage.page,limit:this.dataPage.limit}});200==i.code?(this.labelList=i.data.tabList,this.dataList=i.data.dataList,this.dataPage=i.data.dataPage):this.$xyutil.showToast({title:i.msg,icon:"loading",duration:1500}),this.loading=!1,this.labelIndex=t}))},handleSizeChange(e){this.dataPage.limit=e,this.loadData(this.labelIndex)},handleCurrentChange(e){this.dataPage.page=e,this.loadData(this.labelIndex)}}}),l=window.Vue.renderList,a=window.Vue.Fragment,s=window.Vue.openBlock,o=window.Vue.createElementBlock,d=window.Vue.toDisplayString,n=window.Vue.createTextVNode,r=window.Vue.resolveComponent,u=window.Vue.withCtx,c=window.Vue.createBlock,p=window.Vue.createCommentVNode,h=window.Vue.createElementVNode,m=window.Vue.createVNode,g={class:"p-a"},f={class:"media-list media-list-stream"},y={class:"m-r"},w=["src"],v={class:"flex-1"},x={class:"flex justify-between"},b={class:"m-b-0 text-gray-400"},k={class:"text-gray-400"},I={class:"m-t-sm lh-1-6 text-gray-500"},V={class:"flex m-t-sm"},C=["src"],S={key:0,class:"append p-a bg-gray-100"},_={class:"date"},L={class:"rat"},T={class:"img-video"},$=["src"],z={key:0,class:"flex justify-center"};const P=t(i,[["render",function(e,t,i,P,D,q){const N=r("el-button"),j=r("el-empty"),B=r("el-skeleton"),F=r("el-pagination");return s(),o("div",g,[(s(!0),o(a,null,l(e.labelList,((t,i)=>(s(),c(N,{key:i,class:"m-b-md",type:"primary",text:"",size:"default",bg:i==e.labelIndex,onClick:t=>e.loadData(i)},{default:u((()=>[n(d(t.title)+"("+d(t.count)+") ",1)])),_:2},1032,["bg","onClick"])))),128)),m(B,{loading:e.loading,animated:"",rows:8},{default:u((()=>[0==e.dataList.length?(s(),c(j,{key:0,description:"暂无数据"})):p("",!0),h("ul",f,[(s(!0),o(a,null,l(e.dataList,((t,i)=>(s(),o("li",{key:i,class:"media p-b-md flex"},[h("div",y,[h("img",{style:{width:"48px",height:"48px","border-radius":"50%"},src:t.userInfo.avatar},null,8,w)]),h("div",v,[h("div",x,[h("div",null,[n(d(t.userInfo.nickname)+" ",1),h("span",b,[h("span",null,"（"+d(t.skuSpec)+"）",1)])]),h("small",k,d(e.$xyutil.timeFormat(t.createTime)),1)]),h("p",I,d(t.content),1),h("div",V,[(s(!0),o(a,null,l(t.images,((e,t)=>(s(),o("div",{class:"m-r",key:t},[h("img",{src:e.url,style:{width:"60px",height:"60px"}},null,8,C)])))),128))]),t.append?(s(),o("view",S,[h("view",_,d(e.$xyutil.timeFormat(t.append?t.append.createTime:"")),1),h("view",L,d(t.append.content),1),h("view",T,[(s(!0),o(a,null,l(t.append.images,((e,t)=>(s(),o("div",{class:"m-r",key:t},[h("img",{src:e.url,style:{width:"60px",height:"60px"}},null,8,$)])))),128))])])):p("",!0)])])))),128))])])),_:1},8,["loading"]),0!=e.dataList.length?(s(),o("div",z,[m(F,{class:"m-t-md",size:"default",onSizeChange:e.handleSizeChange,onCurrentChange:e.handleCurrentChange,"current-page":e.dataPage.page,"onUpdate:current-page":t[0]||(t[0]=t=>e.dataPage.page=t),background:"","page-sizes":[10,20,30,50],"page-size":e.dataPage.limit,"onUpdate:page-size":t[1]||(t[1]=t=>e.dataPage.limit=t),layout:"total, sizes, prev, pager, next, jumper",total:e.dataPage.total},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])):p("",!0)])}]]),D=window.Vue.resolveComponent,q=window.Vue.createVNode,N=window.Vue.createElementVNode,j=window.Vue.withCtx,B=window.Vue.toDisplayString,F=window.Vue.createTextVNode,U=window.Vue.renderList,E=window.Vue.Fragment,H=window.Vue.openBlock,G=window.Vue.createElementBlock,M=window.Vue.createBlock,O=window.Vue.createCommentVNode,J=window.Vue.pushScopeId,A=window.Vue.popScopeId,K=e=>(J("data-v-114d064f"),e=e(),A(),e),Q={class:"container m-t"},R={class:"abstract p-a m-b"},W=K((()=>N("p",{class:"text-gray-500"},null,-1))),X={class:"price-box p-a flex justify-between align-top"},Y=K((()=>N("span",{style:{color:"red"}},"¥",-1))),Z={class:"ts-20",style:{color:"red"}},ee={class:"m-l-lg"},te={id:"order-stock"},ie={class:"p-l-lg"},le={class:"m-r m-b-sm"},ae={class:"item-list"},se={class:"p-a-sm"},oe={class:"p-r-lg text-center hidden-sm-and-down"},de=K((()=>N("div",null,"手机扫码访问",-1))),ne={class:"buy-box m-b m-l flex justify-between"},re={class:"p-r-lg xs:p-r-0"},ue=["innerHTML"],ce={class:"m-b"},pe=K((()=>N("div",null,[N("span",null,"店铺信息")],-1))),he={class:"panel-body m-b"},me={class:"panel-body m-b"},ge={class:"seller-head"},fe=K((()=>N("div",{class:"panel-body"},[F(" 客服: "),N("a",{class:"label label-primary",target:"_blank",href:"#"},[N("i",{class:"fa fa-commenting-o"}),F(" 在线联系 ")])],-1))),ye=K((()=>N("div",null,[N("span",null,"推荐商品")],-1))),we=["src","alt"],ve={class:"p-l-xs"},xe={class:"title ts-13 lh-1-6 text-left m-b clamp-2"},be={class:"price text-danger text-left"},ke={data:()=>({loading:!1,id:"",currentTab:"content",promoteType:0,promoteId:0,promoteInfo:{curPrice:0},seckillLeftSeconds:0,info:{skuList:[]},currentImg:"",specClass:"none",specSelected:[],specSelectedIndex:"",amount:1,coupon:{getCouponShow:!1,loadingGetCoupon:!1,couponList:[]},favorite:!1,recList:[]}),created:function(){return e(this,null,(function*(){this.id=this.$route.params.id,this.loadData(),this.loadHot()}))},watch:{$route(){this.id=this.$route.params.id,this.loadData()},specSelected(e){}},methods:{toFavorite(){return e(this,null,(function*(){let e=this.favorite?1:0,t=yield this.$xyutil.request({url:"/v1/ishop/collect/add",method:"post",data:{dataId:this.info.id,isCancel:e}});200==t.code?(this.favorite=!this.favorite,this.$xyutil.showToast({title:t.msg,icon:"loading",duration:1e3})):this.$xyutil.showToast({title:t.msg,icon:"error",duration:2e3})}))},addCart(){return e(this,null,(function*(){this.specSelectedIndex;let e=yield this.$xyutil.request({url:"/v1/ishop/cart/add",method:"post",data:{skuId:this.info.skuList[this.specSelectedIndex].id,promoteId:this.promoteId,promoteType:this.promoteType,amount:this.amount}});200==e.code?this.$xyutil.showToast({title:e.msg,icon:"loading",duration:1e3}):this.$xyutil.showToast({title:e.msg,icon:"error",duration:2e3})}))},buy(){if(this.$xyutil.isLogin()){let e=this;this.orderInfo[e.info.storeId]={skuList:[{itemId:this.info.id,skuId:this.info.skuList[this.specSelectedIndex].id,amount:1,promoteId:this.promoteId,promoteType:this.promoteType}]},this.$router.push({path:"/ishop/order/create",query:{data:`${JSON.stringify({orderInfo:this.orderInfo})}`}})}},selectSpec(e,t){this.specSelected[e]=t.value;let i=!1;for(let l=0;l<this.info.skuList.length;l++)if(this.info.skuList[l].spec==this.specSelected.join(",")){this.specSelectedIndex=l,i=!0;break}0==i&&(this.specSelectedIndex="")},loadData(){return e(this,null,(function*(){this.loading=!0;let e=yield this.$xyutil.request({url:"/v1/ishop/item/info/"+this.id,method:"get"});if(200==e.code&&(this.info=e.data.info,this.specSelected=this.info.skuList[0].spec.split(","),this.specSelectedIndex=0,this.currentImg=this.info.cover,this.dataList=e.data.dataList),this.loading=!1,1==this.promoteType&&(yield this.getSeckillInfo(),this.seckillLeftSeconds=new Date(this.promoteInfo.endTime.replace(/\-/g,"/")).getTime()/1e3-Date.parse(new Date)/1e3),this.$util.getToken()){let e=yield this.$xyutil.request({url:"/v1/ishop/collect/my/0",method:"get",data:{dataId:this.info.id}});200==e.code&&e.data.dataList.length>0&&(this.favorite=!0),yield this.$xyutil.request({url:"/v1/ishop/history/add",method:"post",data:{dataType:0,storeId:this.info.storeId,dataValue:this.info.id}})}}))},loadHot(){return e(this,null,(function*(){let e=yield this.$xyutil.request({url:"/v1/ishop/item/lists",method:"get",data:{limit:4,iadTag:"home_rec"}});200==e.code&&(this.recList=e.data.dataList),this.loading=!1}))},getCoupon(t){return e(this,null,(function*(){let e=yield this.$xyutil.request({url:"/v1/coupon/tpl/get",method:"post",data:{id:t}});200==e.code?this.$xyutil.showToast({title:e.msg,icon:"success",duration:1e3}):this.$xyutil.showToast({title:e.msg,icon:"error",duration:2e3})}))},getSeckillInfo(){return e(this,null,(function*(){let e=yield this.$xyutil.request({url:"/v1/ishop_seckill/seckill/info/"+this.promoteId,method:"get"});200==e.code&&(this.promoteInfo=e.data.info)}))}}},Ie=t(Object.assign(ke,{__name:"info",setup:e=>(e,t)=>{const i=D("xy-images-preview"),l=D("el-col"),a=D("el-descriptions-item"),s=D("xy-choose"),o=D("el-input-number"),d=D("el-descriptions"),n=D("xy-qrcode"),r=D("el-button"),u=D("el-row"),c=D("el-tab-pane"),p=D("el-tabs"),h=D("el-input"),m=D("router-link"),g=D("el-rate"),f=D("el-card");return H(),G("div",Q,[q(u,{gutter:20,class:"bg-white m-b-md p-a"},{default:j((()=>[q(l,{xs:24,md:24,lg:10,offset:0},{default:j((()=>[N("div",null,[q(i,{images:e.info.images},null,8,["images"])])])),_:1}),q(l,{xs:24,md:24,lg:14,offset:0},{default:j((()=>[N("div",R,[N("h4",null,[N("strong",null,B(e.info.title),1)]),W]),N("div",X,[q(d,{title:"",column:1},{default:j((()=>[q(a,{label:"价格"},{default:j((()=>{var t,i,l,a;return[Y,N("span",Z,B((null==(i=null==(t=e.info.skuList)?void 0:t[e.specSelectedIndex])?void 0:i.price)||"--"),1),N("span",ee,[F(" 剩余 "),N("span",te,B((null==(a=null==(l=e.info.skuList)?void 0:l[e.specSelectedIndex])?void 0:a.stock)||0),1),F(" 件 ")])]})),_:1}),q(a,{label:"原价"},{default:j((()=>[N("del",null,"￥"+B(e.info.originalPrice),1)])),_:1}),q(a,{label:"发货"},{default:j((()=>{var t,i;return[F(B((null==(i=null==(t=e.info)?void 0:t.storeInfo)?void 0:i.city)||"--"),1)]})),_:1}),q(a,{label:"运费"},{default:j((()=>[F("¥0")])),_:1}),q(a,{label:"规格"},{default:j((()=>[N("div",ie,[(H(!0),G(E,null,U(e.info.skuSpec,((t,i)=>(H(),G("div",{key:i,class:"attr-list flex items-center"},[N("div",le,B(t.title)+":",1),N("div",ae,[q(s,{options:t.spec,onCustomClick:t=>e.selectSpec(i,t),modelValue:e.specSelected[i],"onUpdate:modelValue":t=>e.specSelected[i]=t},{default:j((e=>[N("div",se,B(e.title),1)])),_:2},1032,["options","onCustomClick","modelValue","onUpdate:modelValue"])])])))),128))])])),_:1}),q(a,{label:"数量"},{default:j((()=>[q(o,{modelValue:e.amount,"onUpdate:modelValue":t[0]||(t[0]=t=>e.amount=t),size:"normal",label:"",min:1,max:1e3,step:1,controls:!0,"controls-position":"both"},null,8,["modelValue"])])),_:1})])),_:1}),N("div",oe,[q(n,{class:"qrcode",style:{opacity:1},value:e.$util.url,options:{width:150,margin:3}},null,8,["value"]),de])]),N("div",ne,[N("div",null,[q(r,{class:"m-b",type:"warning",size:"large",disabled:""===e.specSelectedIndex,onClick:e.buy},{default:j((()=>[F("立即购买")])),_:1},8,["disabled","onClick"]),e.promoteType>0?(H(),M(r,{key:0,class:"m-b",type:"warning",size:"large",disabled:""===e.specSelectedIndex,onClick:e.buy},{default:j((()=>[F("直接购买")])),_:1},8,["disabled","onClick"])):O("",!0),0==e.promoteType?(H(),M(r,{key:1,class:"m-b",type:"danger",size:"large",disabled:""===e.specSelectedIndex,onClick:e.addCart},{default:j((()=>[F("加入购物车")])),_:1},8,["disabled","onClick"])):O("",!0)]),N("div",re,[q(r,{link:"",size:"default",onClick:e.toFavorite},{default:j((()=>[F("收藏宝贝")])),_:1},8,["onClick"])])])])),_:1})])),_:1}),q(u,{gutter:20},{default:j((()=>[q(l,{xs:24,md:24,lg:18,offset:0},{default:j((()=>[q(p,{class:"bg-white min-h-2 p-a",modelValue:e.currentTab,"onUpdate:modelValue":t[1]||(t[1]=t=>e.currentTab=t),type:"card","tab-position":"top"},{default:j((()=>[q(c,{label:"商品详情",name:"content"},{default:j((()=>[N("p",{innerHTML:e.info.content},null,8,ue)])),_:1}),q(c,{label:"商品评价",name:"comment"},{default:j((()=>[q(P,{itemId:e.info.id},null,8,["itemId"])])),_:1})])),_:1},8,["modelValue"])])),_:1}),q(l,{xs:24,md:24,lg:6,offset:0},{default:j((()=>[N("div",ce,[q(h,{type:"text",class:"search-input bg-white",placeholder:"搜索店内商品",value:""})]),q(f,{class:"m-b",shadow:"never","body-style":{padding:"20px"}},{header:j((()=>[pe])),default:j((()=>{var t,i,l,a;return[N("div",he,[N("strong",null,[q(m,{to:"/ishop_store/store/info/"+(null==(i=null==(t=e.info)?void 0:t.storeInfo)?void 0:i.id)},{default:j((()=>{var t,i;return[F(B(null==(i=null==(t=e.info)?void 0:t.storeInfo)?void 0:i.title),1)]})),_:1},8,["to"])])]),N("div",me,[N("div",ge,[F(" 评分: "),q(g,{disabled:"",value:null==(a=null==(l=e.info)?void 0:l.storeInfo)?void 0:a.rate,"allow-half":!0,"show-score":""},null,8,["value"])])]),fe]})),_:1}),q(f,{shadow:"never","body-style":{padding:"20px"}},{header:j((()=>[ye])),default:j((()=>[(H(!0),G(E,null,U(e.recList,((e,t)=>(H(),G("div",{key:t,class:"hot_item text-center"},[q(m,{class:"flex m-b",to:"ishop/item/info/"+e.id},{default:j((()=>[N("img",{width:"80",src:e.cover,alt:e.title},null,8,we),N("div",ve,[N("p",xe,B(e.title),1),N("p",be," ¥"+B(e.price),1)])])),_:2},1032,["to"])])))),128))])),_:1})])),_:1})])),_:1})])}}),[["__scopeId","data-v-114d064f"]]);export{Ie as default};
