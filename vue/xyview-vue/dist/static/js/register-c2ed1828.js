import{_ as e}from"../../index.js";const t={data:()=>({loading:!1,inviteSuffix:"",form:{email:"",password:"",rePassword:"",verify:"",token:"",inviteCode:"",agreement:!1},rule:{email:[{required:!0,message:"请填写邮箱",trigger:"blur"}],password:[{required:!0,message:"请填写密码",trigger:"blur"},{type:"string",min:6,message:"密码至少6位",trigger:"blur"}],verify:[{required:!0,message:"请填写验证码",trigger:"blur"}],token:[{required:!0,message:"请发送验证码",trigger:"blur"}]}}),created:function(){switch(this.$store.state.app.siteInfo.regInvite){case 1:this.inviteSuffix="（可选）";break;case 2:this.inviteSuffix="（必填）"}this.form.inviteCode=this.$store.state.app.inviteCode},methods:{getVerifyToken(e){this.form.token=e.token},handleSubmit(){return e=this,t=null,o=function*(){if(!this.form.agreement)return this.$util.showToast({title:"你需要同意用户协议",icon:"loading",duration:3e3}),!1;this.$store.commit("app/setData",{key:"inviteCode",value:this.form.inviteCode}),this.loading=!0;let e=this;setTimeout((function(){e.loading=!1}),5e3);let t=yield this.$util.request({url:"/v1/reg_email/user/register",data:this.form,method:"post"});"200"==t.code?(this.$util.showToast({title:t.msg,icon:"success",duration:2e3}),this.$store.commit("user/setToken",t.data.token),this.$store.commit("user/setUserInfo",t.data.userInfo),this.$emit("reg-success")):this.$util.showToast({title:t.msg,icon:"loading",duration:3e3}),this.loading=!1},new Promise(((i,r)=>{var l=e=>{try{s(o.next(e))}catch(t){r(t)}},a=e=>{try{s(o.throw(e))}catch(t){r(t)}},s=e=>e.done?i(e.value):Promise.resolve(e.value).then(l,a);s((o=o.apply(e,t)).next())}));var e,t,o}}},o=window.Vue.resolveComponent,i=window.Vue.createVNode,r=window.Vue.withCtx,l=window.Vue.openBlock,a=window.Vue.createBlock,s=window.Vue.createCommentVNode,n=window.Vue.createTextVNode,u=window.Vue.toDisplayString,d=window.Vue.createElementVNode,m={class:"agreement"},f=["href"],p=["href"],c={class:"actions flex"},g=d("div",null,null,-1);const h=e(t,[["render",function(e,t,h,v,w,V){const y=o("el-input"),k=o("el-form-item"),x=o("xy-send-verify"),b=o("el-checkbox"),$=o("el-button"),_=o("router-link"),C=o("el-form");return l(),a(C,{ref:"form",model:w.form,rules:w.rule},{default:r((()=>[i(k,{prop:"email"},{default:r((()=>[i(y,{size:"large",type:"text",prefix:"ios-at-outline",modelValue:w.form.email,"onUpdate:modelValue":t[0]||(t[0]=e=>w.form.email=e),placeholder:"请输入邮箱"},null,8,["modelValue"])])),_:1}),i(k,{prop:"verify"},{default:r((()=>[i(y,{size:"large",autocomplete:"off",type:"text",prefix:"ios-lock-outline",modelValue:w.form.verify,"onUpdate:modelValue":t[1]||(t[1]=e=>w.form.verify=e),placeholder:"请输入验证码"},{append:r((()=>[i(x,{onVerifysuccess:V.getVerifyToken,url:"/v1/email/verify/send",type:"邮箱",account:w.form.email,title:"用户注册"},null,8,["onVerifysuccess","account"])])),_:1},8,["modelValue"])])),_:1}),i(k,{prop:"password"},{default:r((()=>[i(y,{size:"large",type:"password",prefix:"ios-lock-outline",modelValue:w.form.password,"onUpdate:modelValue":t[2]||(t[2]=e=>w.form.password=e),placeholder:"请输入6-18位密码"},null,8,["modelValue"])])),_:1}),e.$store.state.app.siteInfo.regInvite>0?(l(),a(k,{key:0,prop:"inviteCode"},{default:r((()=>[i(y,{size:"large",type:"text",prefix:"ios-lock-outline",modelValue:w.form.inviteCode,"onUpdate:modelValue":t[3]||(t[3]=e=>w.form.inviteCode=e),placeholder:"请输入邀请码"+w.inviteSuffix},null,8,["modelValue","placeholder"])])),_:1})):s("",!0),d("div",m,[i(b,{modelValue:w.form.agreement,"onUpdate:modelValue":t[4]||(t[4]=e=>w.form.agreement=e)},{default:r((()=>[n("我已阅读并同意")])),_:1},8,["modelValue"]),d("a",{href:e.$util.baseDomain()+"/user_agreement/agreement/info.html?name=agreement",target:"_blacnk"}," 《"+u(e.$store.state.app.siteInfo.title)+"用户协议》 ",9,f),n(" 和 "),d("a",{href:e.$util.baseDomain()+"/user_agreement/agreement/info.html?name=privacy",target:"_blacnk"}," 《"+u(e.$store.state.app.siteInfo.title)+"隐私政策》 ",9,p)]),i($,{class:"full submit-btn",size:"large",loading:w.loading,type:"primary",onClick:t[5]||(t[5]=e=>V.handleSubmit("form"))},{default:r((()=>[n(" 注册 ")])),_:1},8,["loading"]),d("div",c,[g,d("div",null,[n(" 已有账号？ "),i(_,{to:"/user/login"},{default:r((()=>[n("登录")])),_:1})])])])),_:1},8,["model","rules"])}]]);export{h as default};
