var e=Object.defineProperty,t=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,o=(t,i,a)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[i]=a,n=(e,t,i)=>new Promise(((a,o)=>{var n=e=>{try{l(i.next(e))}catch(t){o(t)}},d=e=>{try{l(i.throw(e))}catch(t){o(t)}},l=e=>e.done?a(e.value):Promise.resolve(e.value).then(n,d);l((i=i.apply(e,t)).next())}));import{_ as d,b as l}from"../../index.js";import{l as s,u as r}from"./index-e8ee17d1.js";const u=window.Vue.defineAsyncComponent,c={name:"XyBuilderCol",props:{api:"",header:{type:Object,default:()=>({cloudId:0,eid:0})},pitem:{type:Object,default:()=>({})},show:!1,predata:""},data:()=>({id:0,ready:!1,loading:!1,menuVisible:!1,cnode:null,cdata:null,colData:{dataList:[]},currentEditApi:""}),watch:{show(e){this.stackData={},1==e&&this.loadData()}},components:{XyBuilderTab:u((()=>new Promise(((e,t)=>{l((()=>import("./xy-builder-tab-9eeb13e0.js")),["static/js/xy-builder-tab-9eeb13e0.js","index.js","static/css/index-fdd28e6e.css","static/js/index-e8ee17d1.js","static/css/xy-builder-tab-9f6b60da.css"]).then((t=>{e(t)}))})))),XyBuilderInfo:u((()=>new Promise(((e,t)=>{l((()=>import("./xy-builder-info-f33d5a6a.js")),["static/js/xy-builder-info-f33d5a6a.js","index.js","static/css/index-fdd28e6e.css","static/js/button-3b836efa.js","static/js/index-e8ee17d1.js","static/css/xy-builder-info-c015a854.css"]).then((t=>{e(t)}))})))),XyBuilderList:u((()=>new Promise(((e,t)=>{l((()=>import("./xy-builder-list-04dd1086.js")),["static/js/xy-builder-list-04dd1086.js","index.js","static/css/index-fdd28e6e.css","static/js/index-e8ee17d1.js","static/js/button-3b836efa.js","static/css/xy-builder-list-350580b8.css"]).then((t=>{e(t)}))})))),XyBuilderForm:u((()=>new Promise(((e,t)=>{l((()=>import("./xy-builder-form-5305ae0b.js")),["static/js/xy-builder-form-5305ae0b.js","index.js","static/css/index-fdd28e6e.css","static/js/index-e8ee17d1.js","static/css/xy-builder-form-99c53591.css"]).then((t=>{e(t)}))}))))},created(){this.predata?this.readyProcess(this.predata):this.loadData()},methods:{closeModel(){},handleContextmenu(e,t,i,a){this.cnode=i,this.cdata=t,this.menuVisible=!1,this.menuVisible=!0,event.preventDefault();var o=document.querySelector(".menu");this.styleMenu(o)},foo(){this.menuVisible=!1,document.removeEventListener("click",this.foo)},styleMenu(e){event.clientX>1800?e.style.left=event.clientX-100+"px":e.style.left=event.clientX-200+"px",document.addEventListener("click",this.foo),event.clientY>700?e.style.top=event.clientY-300+"px":e.style.top=event.clientY-150+"px"},handleDrop(e,t,i,a){return n(this,null,(function*(){let a;this.colData.rightButtonList.forEach((e=>{"edit"==e.name&&(a=e)}));let o="",n=0;switch(i){case"inner":o=t.data.uniqeId;break;case"before":o=t.data.puniqeId,n=t.data.sortnum-1;break;case"after":o=t.data.puniqeId,n=t.data.sortnum+1}let d=yield this.$xyutil.request({url:a.pageData.api+"/"+e.data.id,method:"put",data:{puniqeId:o,sortnum:n},header:{CloudId:this.header.cloudId,Eid:this.header.eid}});"200"==d.code?this.$xyutil.showToast({title:d.msg,icon:"success",duration:1e3}):this.$xyutil.showToast({title:d.msg,icon:"error",duration:3e3})}))},editPre(e,t){return n(this,null,(function*(){this.$refs.rightForm.getCount()>1?this.$confirm("您有修改内容未保存，确认离开当前页面吗？","提示",{confirmButtonText:"确认离开",cancelButtonText:"留在页面",confirmButtonClass:"el-button--danger",closeOnClickModal:!1,type:"error"}).then((()=>n(this,null,(function*(){this.edit(e,t)})))).catch((()=>{})):this.edit(e,t)}))},edit(e,t){return n(this,null,(function*(){this.$refs.rightForm.getCount(),this.cnode=null,this.cdata=null,this.menuVisible=!1;let e=this;this.colData.rightButtonList.forEach((i=>{if("edit"==i.name){let n=i;var a="",o=new Object;if(n.pageData.apiSuffix){let e=n.pageData.apiSuffix;for(let i of e)a=a+"/"+t[i]}else a="/"+t.id;if(n.pageData.querySuffix){let e=n.pageData.querySuffix;for(let i of e)1==i[2]?o[i[0]]=i[1]:o[i[0]]=t[i[1]]}if(""!=s.stringify(o)?e.currentEditApi=n.pageData.api+a+"?"+s.stringify(o):e.currentEditApi=n.pageData.api+a,!e.currentEditApi)return!1}}))}))},append(e,t){return n(this,null,(function*(){t||((t={}).bookId=this.id,t.puniqeId="",t.title="根节点");let i="";if(this.colData.rightButtonList.forEach((e=>{"addChild"==e.name&&(i=e.pageData.api)})),!i)return!1;this.$prompt("请输入标题","创建“"+t.title+"”的子项",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((a=>n(this,[a],(function*({value:a}){let o=yield this.$xyutil.request({url:i,method:"post",data:{bookId:t.bookId,puniqeId:t.uniqeId,title:a},header:{CloudId:this.header.cloudId,Eid:this.header.eid}});"200"==o.code?(this.$xyutil.showToast({title:o.msg,icon:"success",duration:1e3}),t.children||this.$set(t,"children",[]),e?t.children.push(o.data.info):this.colData.dataList.push(o.data.info)):this.$xyutil.showToast({title:o.msg,icon:"error",duration:3e3})})))).catch((()=>{this.$message({type:"info",message:"取消输入"})}))}))},remove(e,t){let i=this,a="";if(this.colData.rightButtonList.forEach((e=>{"delete"==e.name&&(a=e)})),!a.pageData.api)return!1;var o="",d=new Object;if(a.pageData.apiSuffix){let e=a.pageData.apiSuffix;for(let i of e)o=o+"/"+t[i]}else o="/"+t.id;if(a.pageData.querySuffix){let e=a.pageData.querySuffix;for(let i of e)1==i[2]?d[i[0]]=i[1]:d[i[0]]=t[i[1]]}this.$confirm(a.pageData.content,a.pageData.title,{confirmButtonText:a.pageData.okText,cancelButtonText:a.pageData.cancelText,dangerouslyUseHTMLString:!0,closeOnClickModal:!1,type:"warning"}).then((()=>n(this,null,(function*(){let n=a.pageData.api+o;""!=s.stringify(d)&&(n=n+"?"+s.stringify(d));let l=yield i.$xyutil.request({url:n,method:a.pageData.formMethod,header:i.header});if("200"==l.code){const a=e.parent,o=a.data.children||a.data,n=o.findIndex((e=>e.id===t.id));if(o.splice(n,1),i.$xyutil.showToast({title:l.msg,icon:"success",duration:1e3}),this.$store.state.app.uiAudio){let e=new Audio;e.src="https://cdn.jsdelivr.net/gh/starideas/xyfront/audio/delete.mp3",e.play()}}else i.$xyutil.showToast({title:l.msg,icon:"loading",duration:3e3})})))).catch((()=>{if(this.$store.state.app.uiAudio){let e=new Audio;e.src={NODE_ENV:"production",VUE_APP_I18N_LOCALE:"zh",VUE_APP_I18N_FALLBACK_LOCALE:"zh",VUE_APP_IS_DEMO:"false",VUE_APP_BASE_DOMAIN:"https://uiadmin.net",VUE_APP_PUBLIC_PATH:"./",VUE_APP_CDN_DOMAIN:"https://cdn.jiangruyi.com",VUE_APP_DEPLOY_ALONE:"false",VUE_APP_BASE:"https://cdn.jiangruyi.com/vue/xyview-vue/dist/"}.VUE_APP_AUDIO_CLOSE,e.play()}}))},readyProcess(e){let n=r.readyList({listData:e},this.$store.state.app.apiInfo);this.colData=((e,n)=>{for(var d in n||(n={}))i.call(n,d)&&o(e,d,n[d]);if(t)for(var d of t(n))a.call(n,d)&&o(e,d,n[d]);return e})({},n.listData),this.ready=!0},loadData(e=""){return n(this,null,(function*(){var t,i;if(""!=e&&(this.api=e),this.loading=!0,this.api){let e=yield this.$xyutil.request({url:this.api,method:"get",header:{CloudId:null==(t=this.header)?void 0:t.cloudId,Eid:null==(i=this.header)?void 0:i.eid}});"200"==e.code?(this.readyProcess(e.data.listData),this.id=e.data.id,this.loading=!1):this.$xyutil.showToast({title:e.msg,icon:"loading",duration:3e3})}this.loading=!1}))}}},h=window.Vue.toDisplayString,p=window.Vue.createElementVNode,f=window.Vue.createTextVNode,m=window.Vue.resolveComponent,y=window.Vue.withCtx,g=window.Vue.createVNode,x=window.Vue.vShow,_=window.Vue.withDirectives,w=window.Vue.resolveDirective,D=window.Vue.openBlock,v=window.Vue.createElementBlock;window.Vue.pushScopeId,window.Vue.popScopeId;const E={class:"xy-builder-comp xy-builder-wrap-col"},b={class:"col-box"},P={class:"custom-tree-node flex flex-1 flex-alignCenter","slot-scope":"{ node, data }"},V={class:"actions ts-13",style:{display:"none"}},I={id:"contextmenu",class:"menu"};const A=d(c,[["render",function(e,t,i,a,o,n){const d=m("el-link"),l=m("el-tree"),s=m("el-button"),r=m("el-col"),u=m("XyBuilderForm"),c=m("el-row"),A=w("loading");return D(),v("div",E,[_((D(),v("div",b,[g(c,{gutter:25},{default:y((()=>[g(r,{xs:24,sm:24,md:6,lg:4,class:"left m-b-md"},{default:y((()=>[g(l,{class:"",data:o.colData.dataList,"node-key":"id","default-expand-all":"","highlight-current":"",draggable:"",onNodeContextmenu:n.handleContextmenu,onNodeDrop:n.handleDrop,"expand-on-click-node":!0},{default:y((()=>[p("div",P,[p("div",{class:"flex-1 ts-14 tw5 flex flex-alignCenter",onClick:t[0]||(t[0]=t=>n.editPre(e.node,e.data))},h(e.data.title),1),p("div",V,[g(d,{class:"m-r-xs",type:"text",onClick:t[1]||(t[1]=()=>n.append(e.node,e.data))},{default:y((()=>[f(" 添加子项 ")])),_:1}),g(d,{type:"danger",onClick:t[2]||(t[2]=()=>n.remove(e.node,e.data))},{default:y((()=>[f(" 删除 ")])),_:1})])])])),_:1},8,["data","onNodeContextmenu","onNodeDrop"]),g(s,{class:"full",type:"text",onClick:t[3]||(t[3]=()=>n.append())},{default:y((()=>[f(" 添加 ")])),_:1}),_(p("div",I,[p("div",{class:"contextmenu__item",onClick:t[4]||(t[4]=()=>n.append(o.cnode,o.cdata))},"添加子项"),p("div",{class:"contextmenu__item",onClick:t[5]||(t[5]=()=>n.remove(o.cnode,o.cdata))},"删除")],512),[[x,o.menuVisible]])])),_:1}),g(r,{xs:24,sm:24,md:18,lg:20,class:"right"},{default:y((()=>[g(u,{ref:"rightForm",api:o.currentEditApi,show:!0,header:i.header,onClose:t[6]||(t[6]=e=>n.closeModel(e))},null,8,["api","header"])])),_:1})])),_:1})])),[[A,o.loading]])])}],["__scopeId","data-v-09908250"]]);export{A as default};
