import{_ as D}from"../index-726dc959.js";const B={name:"commentLists",props:{allowZan:{type:Boolean,default:!1},allowLike:{type:Boolean,default:!1},showReplyForm:{type:Boolean,default:!1},title:{type:String,default:"\u8BC4\u8BBA"},dataId:{type:[Number,String],default:0},dataModel:{type:String,default:""},urlPrefix:{type:String,default:""}},data(){return{loading:!1,dataList:[],item:{extra:{tinymce:{height:300,toolbar:"formatselect fontsizeselect | link image media blockquote codesample | bold italic underline strikethrough | forecolor backcolor bullist numlist | code fullscreen | newyear"}}},replyTarget:"",comment:{anonymous:0,tpid:0,tpidIndex:-1,pid:0,dataId:0,dataModel:this.dataModel,content:"",images:[],url:""}}},created:function(){this.comment.dataId=this.dataId,this.loadData()},watch:{dataId(e){this.comment.dataId=this.dataId,this.loadData()},dataModel(e){this.loadData()}},methods:{doreply(e,g="",n=-1){n>=0&&(console.log("index-id",this.dataList[n].id),this.comment.tpidIndex=n,this.comment.tpid=this.dataList[n].id),this.comment.dataId=this.dataId,this.comment.pid=e,this.showReplyForm=!0,this.replyTarget=g,console.log("comment",this.comment)},async reply(){if(this.comment.url=this.urlPrefix+"/"+this.comment.dataId,console.log(this.comment),!this.comment.content)return this.$util.showToast({title:"\u8BF7\u586B\u5199\u56DE\u590D",icon:"error",duration:2e3}),!1;let e=await this.$util.request({url:"/v1/comment/comment/add",method:"post",data:this.comment,header:{}});e.code==200?(this.$util.showToast({title:"\u63D0\u4EA4\u6210\u529F",icon:"none",duration:2e3}),this.$emit("update:showReplyForm",!1),e.data.comment.userInfo=this.$store.state.user.userInfo,this.comment.tpid>0?this.dataList[this.comment.tpidIndex].children.push(e.data.comment):this.dataList.push(e.data.comment),this.replyTarget="",this.comment={anonymous:0,tpid:0,tpidIndex:-1,pid:0,dataId:0,dataModel:this.dataModel,content:"",images:[],url:""}):this.$util.showToast({title:e.msg,icon:"none",duration:2e3})},async actionClick(e,g,n,w=-1){let u=0;w!=-1?u=this.dataList[e].children[w].id:(console.log(w),u=this.dataList[e].id);let l=await this.$util.request({url:"/v1/action/action/set",data:{dataId:u,dataModel:g,actionType:n},method:"post"});l.code==200?(w!=-1?this.$set(this.dataList[e].children[w].actionStates,n,l.data.currentValue):this.$set(this.dataList[e].actionStates,n,l.data.currentValue),this.$util.showToast({title:l.msg,icon:"success",duration:2e3})):this.$util.showToast({title:l.msg,icon:"loading",duration:3e3})},async loadData(){if(!this.dataId||!this.dataModel)return;this.loading=!0;let e=await this.$util.request({url:"/v1/comment/comment/lists",data:{dataId:this.dataId,dataModel:this.dataModel},method:"get"});e.code==200?(this.dataList=e.data.dataList,this.dataList.length==0&&this.$emit("update:showReplyForm",!0)):this.$util.showToast({title:e.msg,icon:"loading",duration:3e3}),this.loading=!1}}},p=window.Vue.resolveComponent,h=window.Vue.createVNode,t=window.Vue.createElementVNode,i=window.Vue.toDisplayString,s=window.Vue.openBlock,c=window.Vue.createElementBlock,d=window.Vue.createCommentVNode,m=window.Vue.createTextVNode,r=window.Vue.withCtx,v=window.Vue.createBlock,L=window.Vue.renderList,T=window.Vue.Fragment,F=window.Vue.normalizeClass,N=window.Vue.resolveDirective,S=window.Vue.withDirectives,q=window.Vue.vShow,R=window.Vue.pushScopeId,E=window.Vue.popScopeId,f=e=>(R("data-v-631728b4"),e=e(),E(),e),H={class:"ts-14"},Z={key:0,class:"m-b"},P={class:"user flex space-between"},U={class:"flex"},j={class:"m-r-sm"},A={class:"title tw5 ts-14"},G={class:"info flex space-between text-gray ts-13",style:{"margin-top":"2px"}},J=f(()=>t("div",{class:"ts-12 text-gray"},"\u5199\u56DE\u590D",-1)),K={key:1,class:"comment-form"},O=m(" \u63D0\u4EA4 "),Q={key:0},W={class:"comment-list",style:{"min-height":"70px"},"element-loading-text":"\u6570\u636E\u52A0\u8F7D\u4E2D"},X={class:"user flex space-between"},Y={class:"flex"},tt={class:"m-r-sm"},et={class:"bg-white"},st={class:"title tw5 ts-14"},ot=m(" \u5B98\u65B9\u4EBA\u5458 "),nt={class:"info flex space-between text-gray ts-13",style:{"margin-top":"2px"}},at={class:"ts-12 text-gray"},it={class:"content ts-14 m-t-sm"},lt=["innerHTML"],ct={key:0,class:"children-list m-l-lg m-t-sm bg-gray-light p-a-sm br-4"},dt={class:"flex space-between ts-13"},rt={class:"m-b-xs"},ut=m(" \u5B98\u65B9\u4EBA\u5458 "),mt=m(" \u56DE\u590D "),ht={class:"ts-12 text-gray"},_t=["innerHTML"],pt={class:"actions flex flex-alignCenter"},ft=["onClick"],gt=f(()=>t("i",{class:"xyicon xyicon-zan ts-14",style:{"margin-right":"3px"}},null,-1)),wt=["onClick"],yt=f(()=>t("i",{class:"xyicon xyicon-reply ts-14",style:{"margin-right":"3px"}},null,-1)),vt=m(" \u56DE\u590D "),kt=["onClick"],xt=f(()=>t("i",{class:"xyicon xyicon-heart ts-14",style:{"margin-right":"3px"}},null,-1)),It={class:"actions m-t flex flex-alignCenter"},bt=f(()=>t("i",{class:"xyicon xyicon-zan ts-14",style:{"margin-right":"3px"}},null,-1)),Vt=["onClick"],Ct=f(()=>t("i",{class:"xyicon xyicon-reply ts-14",style:{"margin-right":"3px"}},null,-1)),Lt=m(" \u56DE\u590D "),Tt=["onClick"],St=f(()=>t("i",{class:"xyicon xyicon-heart ts-14",style:{"margin-right":"3px"}},null,-1));function Mt(e,g,n,w,u,l){const x=p("el-avatar"),M=p("el-input"),I=p("el-button"),$=p("el-alert"),b=p("el-card"),V=p("el-tag"),y=p("el-link"),z=N("loading");return s(),c("div",H,[n.showReplyForm?(s(),v(b,{key:0,class:"box-card m-b-sm",shadow:"never"},{default:r(()=>[e.$util.getToken()?(s(),c("div",Z,[t("div",P,[t("div",U,[t("div",j,[h(x,{shape:"square",icon:"el-icon-user-solid",src:e.$store.state.user.userInfo.avatar},null,8,["src"])]),t("div",null,[t("div",A,i(e.$store.state.user.userInfo.nickname),1),t("div",G,[t("div",null,i(e.$store.state.user.userInfo.slogan?e.$store.state.user.userInfo.slogan:""),1)])])]),J])])):d("",!0),e.$util.getToken?(s(),c("div",K,[h(M,{modelValue:u.comment.content,"onUpdate:modelValue":g[0]||(g[0]=o=>u.comment.content=o),type:"textarea",rows:"4",placeholder:"",size:"default",clearable:""},null,8,["modelValue"]),h(I,{type:"primary",size:"default",onClick:l.reply,class:"m-t-sm m-r",style:{width:"80px"}},{default:r(()=>[O]),_:1},8,["onClick"]),u.replyTarget?(s(),c("span",Q,"\u56DE\u590D"+i(u.replyTarget),1)):d("",!0)])):d("",!0),e.$util.getToken?d("",!0):(s(),v($,{key:2,title:"\u8BF7\u767B\u5F55\u540E\u56DE\u590D",type:"error","show-icon":""}))]),_:1})):d("",!0),S(h(b,{class:"box-card",shadow:"never"},{header:r(()=>[t("span",null,i(n.title)+"\u5217\u8868",1)]),default:r(()=>[S((s(),c("div",W,[(s(!0),c(T,null,L(u.dataList,(o,_)=>(s(),c("div",{class:F(["item p-b-sm border-bottom_1px",_>0?"p-t-sm":""]),key:_},[t("div",X,[t("div",Y,[t("div",tt,[h(x,{icon:"el-icon-user-solid",src:o.userInfo.avatar},null,8,["src"])]),t("div",et,[t("div",st,[m(i(o.userInfo.nickname)+" ",1),o.userInfo.roles||o.userInfo.id==1?(s(),v(V,{key:0,type:"success",size:"small",effect:"dark"},{default:r(()=>[ot]),_:1})):d("",!0)]),t("div",nt,[t("div",null,i(o.userInfo.slogan?o.userInfo.slogan:""),1)])])]),t("div",at,i(e.$util.timeFormat(o.createTime)),1)]),t("div",it,[t("div",{innerHTML:o.content},null,8,lt),o.children.length>0?(s(),c("div",ct,[(s(!0),c(T,null,L(o.children,(a,k)=>(s(),c("div",{class:"m-b-sm m-t-xs",key:k},[t("div",dt,[t("div",rt,[t("span",null,i(a.userInfo.nickname),1),a.userInfo.roles||a.userInfo.id==1?(s(),v(V,{key:0,class:"m-l-xs m-r-xs",type:"success",size:"small",effect:"dark"},{default:r(()=>[ut]),_:1})):d("",!0),mt,t("span",null,i(a.puserInfo?a.puserInfo.nickname:""),1)]),t("div",null,[t("span",ht,"\u56DE\u590D\u4E8E"+i(e.$util.timeFormat(a.createTime)),1)])]),t("div",{class:"m-b-sm",innerHTML:a.content},null,8,_t),t("div",pt,[n.allowZan?(s(),c("div",{key:0,class:"m-r",onClick:C=>l.actionClick(_,"comment",1,k)},[gt,h(y,null,{default:r(()=>[m(i(a.actionStates[1]?"\u5DF2":"")+"\u8D5E\u540C ",1)]),_:2},1024)],8,ft)):d("",!0),t("div",{class:"m-r",onClick:C=>l.doreply(a.id,a.userInfo.nickname,_)},[yt,h(y,null,{default:r(()=>[vt]),_:1})],8,wt),n.allowLike?(s(),c("div",{key:1,class:"m-r",onClick:C=>l.actionClick(_,"comment",2,k)},[xt,h(y,null,{default:r(()=>[m(i(a.actionStates[2]?"\u5DF2":"")+"\u6536\u85CF ",1)]),_:2},1024)],8,kt)):d("",!0)])]))),128))])):d("",!0)]),t("div",It,[n.allowZan?(s(),v(I,{key:0,class:"m-r",type:"primary",size:"small",onClick:a=>l.actionClick(_,"comment",1,-1)},{default:r(()=>[bt,m(" "+i(o.actionStates[1]?"\u5DF2":"")+"\u8D5E\u540C ",1)]),_:2},1032,["onClick"])):d("",!0),t("div",{class:"m-r",onClick:a=>l.doreply(o.id,o.userInfo.nickname)},[Ct,h(y,null,{default:r(()=>[Lt]),_:1})],8,Vt),n.allowLike?(s(),c("div",{key:1,class:"m-r",onClick:a=>l.actionClick(_,"comment",2,-1)},[St,h(y,null,{default:r(()=>[m(i(o.actionStates[2]?"\u5DF2":"")+"\u6536\u85CF ",1)]),_:2},1024)],8,Tt)):d("",!0)])],2))),128))])),[[z,u.loading]])]),_:1},512),[[q,u.dataList.length>0]])])}var zt=D(B,[["render",Mt],["__scopeId","data-v-631728b4"]]);export{zt as c};
