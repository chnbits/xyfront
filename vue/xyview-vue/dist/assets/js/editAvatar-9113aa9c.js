import{a as y}from"../index-91ea30ae.js";const C={name:"editAvatar",props:{showPopup:!1},data(){return{loadedScript:!1,filename:"",avatarURL:"",previews:{},option:{img:"",info:!0,outputSize:1,full:!0,outputType:"png",canMove:!0,original:!1,canMoveBox:!0,autoCrop:!0,autoCropWidth:150,autoCropHeight:150,fixed:!0,fixedBox:!0}}},created:async function(){await this.loadScript(),Vue.use(window["vue-cropper"].default),this.loadedScript=!0,this.option.img=this.$store.state.user.userInfo.avatar,this.filename=this.guid()+".png"},watch:{},methods:{guid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,r=e=="x"?t:t&3|8;return r.toString(16)})},saveEditAvatar(){this.finish("blob")},changeScale(e){e=e||1,this.$refs.cropper.changeScale(e)},rotateLeft(){this.$refs.cropper.rotateLeft()},rotateRight(){this.$refs.cropper.rotateRight()},finish(e){e==="blob"?this.$refs.cropper.getCropBlob(async t=>{console.log(t);let r=await this.$xyutil.uploadFile({driver:this.$store.state.app.uploadDriver,header:{token:this.$xyutil.config.getToken()},blobInfo:{blob(){return t},filename(){return this.filename}}});r.data?(this.avatarURL=r.data.url,this.submit()):this.$util.showToast({title:"\u4E0A\u4F20\u5931\u8D25",icon:"loading",duration:3e3})}):this.$refs.cropper.getCropData(t=>{})},realTime(e){this.previews=e},down(e){var t=document.createElement("a");t.download="author-img",e==="blob"?this.$refs.cropper.getCropBlob(r=>{t.href=window.URL.createObjectURL(r),t.click()}):this.$refs.cropper.getCropData(r=>{t.href=r,t.click()})},uploadImg(e){var t=this;this.filename=e.name;var r=new FileReader;r.onload=u=>{let o;typeof u.target.result=="object"?o=window.URL.createObjectURL(new Blob([u.target.result])):o=u.target.result,t.option.img=o},r.readAsArrayBuffer(e.raw)},async submit(){if(!this.avatarURL)return;let e=await this.$util.request({url:"/v1/core/user/avatar",data:{avatar:this.avatarURL},method:"put"});e.code==200?(this.$util.showToast({title:e.msg,icon:"success",duration:2e3}),this.$router.back(-1),this.showPopup=!1):this.$util.showToast({title:e.msg,icon:"loading",duration:3e3})},loadScript(){let e=this;return new Promise((t,r)=>{e.VueScript2.load(this.$xyutil.config.jsBaseUrl+"libs/vue-cropper/dist/index.js").then(function(){t()})})}}},p=window.Vue.createTextVNode,c=window.Vue.resolveComponent,n=window.Vue.withCtx,i=window.Vue.createVNode,a=window.Vue.createElementVNode,m=window.Vue.openBlock,k=window.Vue.createBlock,V=window.Vue.createCommentVNode,x=window.Vue.normalizeStyle,B=window.Vue.createElementBlock,S=window.Vue.pushScopeId,R=window.Vue.popScopeId,w=e=>(S("data-v-611ac1c4"),e=e(),R(),e),T={class:"bg-white p-a"},z={class:"p-t"},L=p("\u4E2A\u4EBA\u8BBE\u7F6E"),I=p("\u4FEE\u6539\u5934\u50CF"),M={class:"cropper text-center m-b-lg"},U=w(()=>a("span",{class:"text-gray ts-14"},[a("i",{class:"xyicon xyicon-help-o ts-14"}),p(" \u6EDA\u52A8\u9F20\u6807\u6EDA\u8F6E\u4EE5\u7F29\u653E\u56FE\u7247 ")],-1)),N={class:"previewBox"},j={class:"preview-wrap"},A=["src"],E=p(" \u4E0A\u4F20\u65B0\u5934\u50CF "),H=w(()=>a("br",null,null,-1)),P={class:"m-t-md flex flex-end p-r-md"},W=p("\u53D6\u6D88"),D=p("\u4FDD\u5B58");function F(e,t,r,u,o,s){const f=c("el-breadcrumb-item"),v=c("el-breadcrumb"),g=c("vue-cropper"),_=c("el-col"),l=c("el-button"),b=c("el-upload"),d=c("el-row");return m(),B("div",T,[a("div",z,[i(v,{"separator-class":"el-icon-arrow-right",class:"p-l m-b"},{default:n(()=>[i(f,{to:{path:"/user/center"}},{default:n(()=>[L]),_:1}),i(f,null,{default:n(()=>[I]),_:1})]),_:1})]),i(d,{gutter:60},{default:n(()=>[i(_,{xs:24,sm:24,md:12,offset:0},{default:n(()=>[a("div",M,[o.loadedScript?(m(),k(g,{key:0,ref:"cropper",class:"m-b",img:o.option.img,outputSize:o.option.size,outputType:o.option.outputType,info:o.option.info,full:o.option.full,canMove:o.option.canMove,canMoveBox:o.option.canMoveBox,original:o.option.original,autoCrop:o.option.autoCrop,autoCropWidth:o.option.autoCropWidth,autoCropHeight:o.option.autoCropHeight,fixedBox:o.option.fixedBox,onRealTime:s.realTime},null,8,["img","outputSize","outputType","info","full","canMove","canMoveBox","original","autoCrop","autoCropWidth","autoCropHeight","fixedBox","onRealTime"])):V("",!0),U])]),_:1}),i(_,{xs:24,sm:24,md:12,offset:0},{default:n(()=>[a("div",N,[a("div",j,[a("div",{style:x(o.previews.div),class:"preview"},[a("img",{src:o.previews.url,style:x(o.previews.img)},null,12,A)],4)]),i(d,{class:"m-t-md m-b",type:"flex",justify:"center"},{default:n(()=>[i(b,{action:"","show-file-list":!1,"auto-upload":!1,"on-change":s.uploadImg},{default:n(()=>[i(l,{size:"small",type:"primary"},{default:n(()=>[E]),_:1})]),_:1},8,["on-change"])]),_:1}),H,i(d,null,{default:n(()=>[i(l,{icon:"xyicon xyicon-plus",circle:"",size:"small",onClick:t[0]||(t[0]=h=>s.changeScale(1))}),i(l,{icon:"el-icon-minus",circle:"",size:"small",onClick:t[1]||(t[1]=h=>s.changeScale(-1))}),i(l,{icon:"el-icon-download",circle:"",size:"small",onClick:t[2]||(t[2]=h=>s.down("blob"))}),i(l,{icon:"el-icon-refresh-left",circle:"",size:"small",onClick:s.rotateLeft},null,8,["onClick"]),i(l,{icon:"el-icon-refresh-right",circle:"",size:"small",onClick:s.rotateRight},null,8,["onClick"])]),_:1})])]),_:1})]),_:1}),a("div",P,[i(l,{onClick:t[3]||(t[3]=h=>r.showPopup=!1)},{default:n(()=>[W]),_:1}),i(l,{type:"primary",onClick:s.saveEditAvatar},{default:n(()=>[D]),_:1},8,["onClick"])])])}var q=y(C,[["render",F],["__scopeId","data-v-611ac1c4"]]);export{q as default};
