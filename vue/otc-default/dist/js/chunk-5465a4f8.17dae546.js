(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-5465a4f8"],{1107:function(e,t,i){},"460d":function(e,t,i){"use strict";var a=i("1107");i.n(a).a},"5c03":function(e,t,i){"use strict";i("a9e3"),i("96cf");var a=i("1da1"),n={name:"xySendVerify",props:{noNeedAccount:{type:Boolean,default:!1},account:{type:String,default:""},title:{type:String,default:""},url:{type:String,default:"/v1/sms/verify/send"},type:{type:String,default:"手机号"},time:{type:Number,default:30}},data:function(){return{label:"发送验证码",timeLeft:0}},created:function(){},methods:{sendVerify:function(){var e=this;return Object(a.a)(regeneratorRuntime.mark((function t(){var i,a,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0<e.timeLeft)return t.abrupt("return");t.next=2;break;case 2:if(e.account||e.noNeedAccount){t.next=5;break}return e.util.showToast({title:"请输入"+e.type,icon:"loading",duration:1e3}),t.abrupt("return",!1);case 5:return e.timeLeft=e.time,e.label="剩余"+e.timeLeft+"s",i=setInterval((function(){e.timeLeft--,e.timeLeft<=0?(e.label="发送验证码",e.timeLeft=0,clearInterval(i)):e.label="剩余"+e.timeLeft+"s"}),1e3),a={},a="手机号"==e.type?{mobile:e.account,title:e.title}:{email:e.account,title:e.title},t.next=12,e.util.request({url:e.url,data:a,method:"post"});case 12:"200"==(n=t.sent).code?(e.util.showToast({title:n.msg,icon:"success",duration:1e3}),e.$emit("verifysuccess",n.data)):e.util.showToast({title:n.msg,icon:"loading",duration:2e3});case 14:case"end":return t.stop()}}),t)})))()}}},r=i("2877"),s=Object(r.a)(n,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"send-verify p-l-xs p-r-xs"},[i("el-button",{attrs:{type:"text"},on:{click:e.sendVerify}},[e._v(e._s(e.label))])],1)}),[],!1,null,"0372c606",null);t.a=s.exports},6119:function(e,t,i){"use strict";i.r(t),i("96cf");var a,n=i("1da1"),r={components:{"xy-safety-verify":i("6f6d").a},data:function(){var e=this;return{verifyData:"",id:0,info:{coinInfo:{symbol:""},otcUser:{tradeCount:0,kycInfo:{realName:""}},userInfo:{avatar:""}},buyForm:{money:"",amount:""},rules:{money:[{required:!0,message:"请输入金额",trigger:"blur"},{validator:function(t,i,a){i<=0&&a(new Error("请输入正确的金额")),i>e.otcUserInfo.todayLeft&&a(new Error("今日限额最多"+e.otcUserInfo.todayLeft)),i>e.info.maxMoney&&a(new Error("本次金额最多"+e.info.maxMoney)),i<e.info.minMoney&&a(new Error("本次金额最少"+e.info.minMoney)),a()},trigger:"blur"}],amount:[{required:!0,message:"请输入数量",trigger:"blur"},{validator:function(t,i,a){i<=0&&a(new Error("请输入正确的数量")),i>e.info.leftAmount&&a(new Error("本次数量最多"+e.info.leftAmount)),1==e.info.type&&i>e.coinBalance.balance&&a(new Error("最多出售"+e.coinBalance.balance)),a()},trigger:"blur"}]},alipay:"",wxpay:"",bank:"",otcUserInfo:{kycInfo:{},paytypeList:[]},coinBalance:{}}},created:(a=Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.id=this.$route.params.id,e.next=3,this.loadData(this.id);case 3:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)}),watch:{},methods:{trade:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var i,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:0==e.otcUserInfo.paytypeList.length&&e.util.showToast({title:"请先完善收款方式",icon:"none",duration:1e3}),e.otcUserInfo.kycInfo||e.util.showToast({title:"请先进行KYC实名认证",icon:"none",duration:1e3}),a="",a=2==e.info.type?(i=1,"buyForm"):(e.alipay||e.wxpay||e.bank||e.util.showToast({title:"请选择收款方式",icon:"loading",duration:3e3}),i=2,"sellForm"),e.$refs[a].validate(function(){var t=Object(n.a)(regeneratorRuntime.mark((function t(a){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a)return t.next=3,e.util.request({url:"/v1/coin_otc/order/add/"+e.id,data:{adId:e.id,coinId:e.info.coinId,type:i,amount:e.buyForm.amount,totalPrice:e.buyForm.money,alipay:e.alipay,wxpay:e.wxpay,bank:e.bank,_verify:e.verifyData},method:"post"});t.next=16;break;case 3:if(200!=(n=t.sent).code){t.next=8;break}e.util.navigateTo({url:"/coin_otc/order/info/"+n.data.orderId}),t.next=14;break;case 8:if(401003==n.code)return e.$refs.sv.open(n.data.verifyList),t.abrupt("return");t.next=13;break;case 13:e.util.showToast({title:n.msg,icon:"loading",duration:3e3});case 14:t.next=18;break;case 16:return t.abrupt("return",!1);case 18:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 5:case"end":return t.stop()}}),t)})))()},inputMoney:function(){this.buyForm.money=math.round(math.bignumber(this.buyForm.money),2),this.buyForm.amount=math.round(math.bignumber(this.buyForm.money)/math.bignumber(this.info.price),this.info.coinInfo.decimals)},inputAmount:function(){this.buyForm.amount=math.round(math.bignumber(this.buyForm.amount),this.info.coinInfo.decimals),this.buyForm.money=math.round(math.bignumber(this.buyForm.amount)*math.bignumber(this.info.price),2)},setAllAmount:function(e){this.buyForm.amount=e,this.inputAmount()},loadBalance:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.util.request({url:"/v1/coin/balance/info/"+e.info.coinId,method:"get"});case 2:200==(i=t.sent).code?e.coinBalance=i.data.info:e.util.showToast({title:i.msg,icon:"loading",duration:3e3});case 4:case"end":return t.stop()}}),t)})))()},loadData:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function i(){var a,n;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,t.util.request({url:"/v1/coin_otc/ad/info/"+e,data:{},method:"get"});case 2:return 200==(a=i.sent).code?t.info=a.data.info:t.util.showToast({title:a.msg,icon:"loading",duration:3e3}),i.next=6,t.util.request({url:"/v1/coin_otc/user/my",data:{},method:"get"});case 6:if(200==(n=i.sent).code)return t.otcUserInfo=n.data.info,i.next=11,t.loadBalance();i.next=13;break;case 11:i.next=14;break;case 13:t.util.showToast({title:n.msg,icon:"loading",duration:3e3});case 14:case"end":return i.stop()}}),i)})))()}}},s=(i("460d"),i("2877")),o=Object(s.a)(r,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"wrap"},[i("script2",{attrs:{src:"https://cdn.jsdelivr.net/npm/mathjs@6.2.5/dist/math.min.js"}}),i("xy-header"),i("div",{staticClass:"main p-t"},[i("div",{staticClass:"container"},[i("el-row",{attrs:{type:"flex",gutter:18}},[i("el-col",{attrs:{span:16}},[i("el-steps",{staticClass:"m-b",attrs:{active:1,simple:""}},[i("el-step",{attrs:{title:"待下单"}}),i("el-step",{attrs:{title:"待支付"}}),i("el-step",{attrs:{title:"待放币"}}),i("el-step",{attrs:{title:"交易完成"}})],1),i("el-card",{staticClass:"ad-info",attrs:{shadow:"never"}},[i("div",{staticClass:"flex flex-alignCenter"},[i("el-avatar",{attrs:{size:"medium",src:e.info.userInfo.avatar}}),i("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(e.info.userInfo.nickname))]),i("el-tag",{staticClass:"m-l-sm",attrs:{size:"mini"}},[e._v("KYC1")]),i("span",{staticClass:"m-l-md"},[e._v("交易 "),i("span",[e._v(e._s(e.info.otcUser.tradeCount))])]),i("span",{staticClass:"m-l"},[e._v("好评率 "),i("span",[e._v(e._s(e.info.otcUser.goodRate)+" %")])])],1),i("el-divider"),i("div",{staticClass:"flex",staticStyle:{"justify-content":"space-between"}},[i("div",[i("div",[e._v("单价")]),i("div",[e._v(e._s(e.info.price))])]),i("div",[i("div",[e._v("数量")]),i("div",[e._v(e._s(e.info.leftAmount)+" "+e._s(e.info.coinName))])]),i("div",[i("div",[e._v("单笔限额")]),i("div",[e._v(e._s(e.info.minMoney)+" - "+e._s(e.info.maxMoney)+" CNY")])]),i("div",[i("div",[e._v("收款方式")]),i("div",[i("i",{directives:[{name:"show",rawName:"v-show",value:e.info.alipay,expression:"info.alipay"}],staticClass:"xyicon xyicon-alipay m-r-xs",staticStyle:{color:"#4C88FE"}}),i("i",{directives:[{name:"show",rawName:"v-show",value:e.info.wxpay,expression:"info.wxpay"}],staticClass:"xyicon xyicon-wxpay m-r-xs",staticStyle:{color:"#00C901"}}),i("i",{directives:[{name:"show",rawName:"v-show",value:e.info.bank,expression:"info.bank"}],staticClass:"xyicon xyicon-card",staticStyle:{color:"#F7BA2A"}})])])])],1),i("el-card",{staticClass:"m-t trade-info",attrs:{shadow:"never"}},[i("div",{staticClass:"text-right font-sm m-b-sm"},[i("span",{staticClass:"m-r"},[e._v("当前剩余 "+e._s(e.coinBalance.balance)+" "+e._s(e.info.coinInfo.symbol))]),i("span",[e._v("当前可用交易额度 "+e._s(e._f("toThousands")(e.otcUserInfo.todayLeft))+"CNY")])]),i("div",{directives:[{name:"show",rawName:"v-show",value:2==e.info.type,expression:"info.type == 2"}]},[i("el-form",{ref:"buyForm",attrs:{model:e.buyForm,rules:e.rules}},[i("div",{staticClass:"flex",staticStyle:{"align-items":"center"}},[i("el-form-item",{attrs:{label:"",prop:"money"}},[i("el-input",{attrs:{placeholder:"输入想要购买的金额"},on:{input:e.inputMoney},model:{value:e.buyForm.money,callback:function(t){e.$set(e.buyForm,"money",t)},expression:"buyForm.money"}},[i("div",{staticClass:"text-default p-r-sm",staticStyle:{"font-weight":"500","line-height":"40px"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("CNY")])])],1),i("i",{staticClass:"m-l m-b m-r font-xl xyicon xyicon-exchange text-primary"}),i("el-form-item",{attrs:{label:"",prop:"amount"}},[i("el-input",{attrs:{placeholder:"输入想要购买的数量"},on:{input:e.inputAmount},model:{value:e.buyForm.amount,callback:function(t){e.$set(e.buyForm,"amount",t)},expression:"buyForm.amount"}},[i("div",{staticClass:"text-default p-r-sm",staticStyle:{"font-weight":"500","line-height":"40px"},attrs:{slot:"suffix"},slot:"suffix"},[e._v(" "+e._s(e.info.coinInfo.symbol)+" "),i("el-divider",{attrs:{direction:"vertical"}}),i("span",{staticClass:"text-primary",on:{click:function(t){return e.setAllAmount(this.info.leftAmount)}}},[e._v("全部")])],1)])],1)],1),i("el-button",{staticClass:"full m-t",attrs:{size:"medium",type:"primary"},on:{click:function(t){return e.trade()}}},[e._v("购买")])],1)],1),i("div",{directives:[{name:"show",rawName:"v-show",value:1==e.info.type,expression:"info.type == 1"}]},[i("el-form",{ref:"sellForm",attrs:{model:e.buyForm,rules:e.rules}},[i("div",{staticClass:"flex",staticStyle:{"align-items":"center"}},[i("el-form-item",{attrs:{label:"",prop:"amount"}},[i("el-input",{attrs:{placeholder:"输入想要出售的数量"},on:{input:e.inputAmount},model:{value:e.buyForm.amount,callback:function(t){e.$set(e.buyForm,"amount",t)},expression:"buyForm.amount"}},[i("div",{staticClass:"text-default p-r-sm",staticStyle:{"font-weight":"500","line-height":"40px"},attrs:{slot:"suffix"},slot:"suffix"},[e._v(" "+e._s(e.info.coinInfo.symbol)+" "),i("el-divider",{attrs:{direction:"vertical"}}),i("span",{staticClass:"text-primary",on:{click:function(t){return e.setAllAmount(this.coinBalance.balance)}}},[e._v("全部")])],1)])],1),i("i",{staticClass:"m-l m-r font-xl xyicon xyicon-exchange text-primary"}),i("el-form-item",{attrs:{label:"",prop:"money"}},[i("el-input",{attrs:{placeholder:"输入想要出售的金额"},on:{input:e.inputMoney},model:{value:e.buyForm.money,callback:function(t){e.$set(e.buyForm,"money",t)},expression:"buyForm.money"}},[i("div",{staticClass:"text-default p-r-sm",staticStyle:{"font-weight":"500","line-height":"40px"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("CNY")])])],1)],1),i("div",{staticClass:"text-gray ts-13"},[e._v("收款方式:")]),i("div",{staticClass:"m-t-sm"},[i("div",{staticClass:"m-b-sm flex flex-alignCenter"},[i("span",{staticClass:"m-r",staticStyle:{width:"70px"}},[e._v("支付宝")]),i("el-select",{staticClass:"flex-1",model:{value:e.alipay,callback:function(t){e.alipay=t},expression:"alipay"}},[e._l(e.otcUserInfo.paytypeList,(function(t,a){return[1==t.paytype?i("el-option",{key:a,attrs:{value:t.id,label:t.name+"-"+t.account}}):e._e()]}))],2)],1),i("div",{staticClass:"m-b-sm flex flex-alignCenter"},[i("span",{staticClass:"m-r",staticStyle:{width:"70px"}},[e._v("微信支付")]),i("el-select",{staticClass:"flex-1",model:{value:e.wxpay,callback:function(t){e.wxpay=t},expression:"wxpay"}},[e._l(e.otcUserInfo.paytypeList,(function(t,a){return[2==t.paytype?i("el-option",{key:a,attrs:{value:t.id,label:t.name+"-"+t.account}}):e._e()]}))],2)],1),i("div",{staticClass:"flex flex-alignCenter"},[i("span",{staticClass:"m-r",staticStyle:{width:"70px"}},[e._v("银行卡")]),i("el-select",{staticClass:"flex-1",model:{value:e.bank,callback:function(t){e.bank=t},expression:"bank"}},[e._l(e.otcUserInfo.paytypeList,(function(t,a){return[3==t.paytype?i("el-option",{key:a,attrs:{value:t.id,label:t.name+"-"+t.account}}):e._e()]}))],2)],1)]),i("el-button",{staticClass:"full m-t",attrs:{size:"medium",type:"success"},on:{click:function(t){return e.trade()}}},[e._v("出售")])],1)],1)]),i("el-card",{staticClass:"m-t memo-info",attrs:{shadow:"never"}},[i("div",[e._v("备注：")]),i("div",[e._v(e._s(e.info.memo?e.info.memo:"沒有留言"))])])],1),i("el-col",{attrs:{span:8}},[i("el-card",{staticClass:"user-card"},[i("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[i("el-avatar",{attrs:{size:"medium",src:e.info.userInfo.avatar}}),i("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(e.info.userInfo.nickname))])],1),i("div",{staticClass:"ts-14"},[i("div",[e._v("联系电话："+e._s(e.info.userInfo.mobile?e.info.userInfo.mobile.identifier:""))]),i("div",[e._v("姓名："+e._s(e.info.otcUser.kycInfo.realName))]),i("div",[e._v("身份证: "+e._s(e.info.otcUser.kycInfo.certNo))])])])],1)],1)],1)]),i("xy-footer"),i("xy-safety-verify",{ref:"sv",on:{"verify-request":e.trade},model:{value:e.verifyData,callback:function(t){e.verifyData=t},expression:"verifyData"}})],1)}),[],!1,null,"65d66a84",null);t.default=o.exports},"6f6d":function(e,t,i){"use strict";i("96cf");var a=i("1da1"),n={name:"xySafetyVerify",components:{XySendVerify:i("5c03").a},props:{value:{type:[String,Object],default:""}},data:function(){return{dialogVisible:!1,verifyList:[],loading:!1,form:{paypwd:"",password:"",emailVerify:"",emailToken:"",mobileVerify:"",mobileToken:"",gauth:""},rule:{}}},created:function(){},methods:{getVerifyToken:function(e){this.form.emailToken=e.token},getMobileVerifyToken:function(e){this.form.mobileToken=e.token},open:function(e){this.verifyList=e,this.getRule(),this.dialogVisible=!0},eclose:function(){this.$emit("cancel")},close:function(){this.dialogVisible=!1},handleSubmit:function(){var e=this;return Object(a.a)(regeneratorRuntime.mark((function t(){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.loading=!0,i=e,setTimeout((function(){i.loading=!1}),5e3),e.$emit("input",e.form),e.$emit("verify-request"),e.loading=!1;case 6:case"end":return t.stop()}}),t)})))()},getRule:function(){for(var e in this.verifyList)switch(this.verifyList[e]){case"email":this.rule.email=[{required:!0,message:"请填写邮箱验证码",trigger:"blur"},{type:"string",min:6,message:"至少6位",trigger:"blur"}];break;case"mobile":this.rule.mobile=[{required:!0,message:"请填写手机验证码",trigger:"blur"},{type:"string",min:6,message:"至少6位",trigger:"blur"}];break;case"gauth":this.rule.gauth=[{required:!0,message:"请填写谷歌验证码",trigger:"blur"},{type:"string",min:6,message:"密码至少6位",trigger:"blur"}];break;case"paypwd":this.rule.paypwd=[{required:!0,message:"请填写支付密码",trigger:"blur"},{type:"string",min:6,message:"密码至少6位",trigger:"blur"}];break;case"password":this.rule.password=[{required:!0,message:"请填写登录密码",trigger:"blur"},{type:"string",min:6,message:"密码至少6位",trigger:"blur"}]}}}},r=i("2877"),s=Object(r.a)(n,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{"append-to-body":"",title:"安全验证",visible:e.dialogVisible,width:"450px"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.eclose}},[i("el-form",{ref:"form",attrs:{model:e.form,rules:e.rule}},[0<=e.verifyList.indexOf("email")?i("el-form-item",{attrs:{label:"邮箱验证码",prop:"emailVerify"}},[i("el-input",{attrs:{size:"large",autocomplete:"off",type:"text",prefix:"ios-lock-outline",placeholder:"请输入邮箱验证码"},model:{value:e.form.emailVerify,callback:function(t){e.$set(e.form,"emailVerify",t)},expression:"form.emailVerify"}},[i("XySendVerify",{attrs:{slot:"append",url:"/v1/email/verify/send",type:"邮箱",noNeedAccount:!0,title:"安全验证"},on:{verifysuccess:e.getVerifyToken},slot:"append"})],1)],1):e._e(),0<=e.verifyList.indexOf("mobile")?i("el-form-item",{attrs:{label:"手机验证码",prop:"mobileVerify"}},[i("el-input",{attrs:{size:"large",autocomplete:"off",type:"text",prefix:"ios-lock-outline",placeholder:"请输入手机验证码"},model:{value:e.form.mobileVerify,callback:function(t){e.$set(e.form,"mobileVerify",t)},expression:"form.mobileVerify"}},[i("XySendVerify",{attrs:{slot:"append",url:"/v1/sms/verify/send",type:"手机号",noNeedAccount:!0,title:"安全验证"},on:{verifysuccess:e.getMobileVerifyToken},slot:"append"})],1)],1):e._e(),0<=e.verifyList.indexOf("gauth")?i("el-form-item",{attrs:{label:"谷歌验证码",prop:"gauth"}},[i("el-input",{attrs:{size:"large",type:"password",prefix:"ios-lock-outline",placeholder:"请输入谷歌验证码"},model:{value:e.form.gauth,callback:function(t){e.$set(e.form,"gauth",t)},expression:"form.gauth"}})],1):e._e(),0<=e.verifyList.indexOf("paypwd")?i("el-form-item",{attrs:{label:"支付密码",prop:"paypwd"}},[i("el-input",{attrs:{size:"large",type:"password",prefix:"ios-lock-outline",placeholder:"请输入6-18位支付密码"},model:{value:e.form.paypwd,callback:function(t){e.$set(e.form,"paypwd",t)},expression:"form.paypwd"}})],1):e._e(),0<=e.verifyList.indexOf("password")?i("el-form-item",{attrs:{label:"登录密码",prop:"password"}},[i("el-input",{attrs:{size:"large",type:"password",prefix:"ios-lock-outline",placeholder:"请输入登录密码"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1):e._e(),i("el-button",{staticClass:"full submit-btn",attrs:{size:"large",loading:e.loading,type:"primary"},on:{click:function(t){return e.handleSubmit("form")}}},[e._v(" 确认 ")])],1)],1)}),[],!1,null,"46eee942",null);t.a=s.exports}}]);