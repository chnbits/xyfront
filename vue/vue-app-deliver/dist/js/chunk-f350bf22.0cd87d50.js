(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f350bf22"],{b593:function(t,e,r){"use strict";r.r(e);var i=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("el-row",{attrs:{type:"flex",justify:"space-around"}},[r("div",{staticClass:"cropper text-center"},[t.loadedScript?r("vue-cropper",{ref:"cropper",staticClass:"m-b",attrs:{img:t.option.img,outputSize:t.option.size,outputType:t.option.outputType,info:t.option.info,full:t.option.full,canMove:t.option.canMove,canMoveBox:t.option.canMoveBox,original:t.option.original,autoCrop:t.option.autoCrop,autoCropWidth:t.option.autoCropWidth,autoCropHeight:t.option.autoCropHeight,fixedBox:t.option.fixedBox},on:{realTime:t.realTime}}):t._e(),r("span",{staticClass:"text-gray ts-14"},[r("i",{staticClass:"xyicon xyicon-help-o ts-14"}),t._v(" 滚动鼠标滚轮来缩放图片 ")])],1),r("div",{staticClass:"previewBox"},[r("div",{staticClass:"preview-wrap"},[r("div",{staticClass:"preview",style:t.previews.div},[r("img",{style:t.previews.img,attrs:{src:t.previews.url}})])]),r("el-row",{staticClass:"m-t-md m-b",attrs:{type:"flex",justify:"center"}},[r("el-upload",{attrs:{action:"","show-file-list":!1,"auto-upload":!1,"on-change":t.uploadImg}},[r("el-button",{attrs:{size:"small",type:"primary"}},[t._v(" 更换头像 ")])],1)],1),r("br"),r("el-row",[r("el-button",{attrs:{icon:"el-icon-plus",circle:"",size:"mini"},on:{click:function(e){return t.changeScale(1)}}}),r("el-button",{attrs:{icon:"el-icon-minus",circle:"",size:"mini"},on:{click:function(e){return t.changeScale(-1)}}}),r("el-button",{attrs:{icon:"el-icon-download",circle:"",size:"mini"},on:{click:function(e){return t.down("blob")}}}),r("el-button",{attrs:{icon:"el-icon-refresh-left",circle:"",size:"mini"},on:{click:t.rotateLeft}}),r("el-button",{attrs:{icon:"el-icon-refresh-right",circle:"",size:"mini"},on:{click:t.rotateRight}})],1)],1)]),r("div",{staticClass:"m-t-md flex flex-end p-r-md"},[r("el-button",{attrs:{round:""},on:{click:function(e){t.showPopup=!1}}},[t._v("取消")]),r("el-button",{attrs:{type:"primary",round:""},on:{click:t.saveEditAvatar}},[t._v("保存")])],1)],1)},o=[],n=r("53ca"),a=r("1da1"),c=(r("ac1f"),r("5319"),r("d3b7"),r("25f0"),r("3ca3"),r("ddb0"),r("2b3d"),r("b0c0"),r("96cf"),{name:"editAvatar",props:{showPopup:!1},data:function(){return{loadedScript:!1,filename:"",avatarURL:"",previews:{},option:{img:"",info:!0,outputSize:1,full:!0,outputType:"png",canMove:!0,original:!1,canMoveBox:!0,autoCrop:!0,autoCropWidth:150,autoCropHeight:150,fixed:!0,fixedBox:!0}}},created:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.loadScript();case 2:Vue.use(window["vue-cropper"].default),this.loadedScript=!0,this.option.img=this.$store.state.user.userInfo.avatar,this.filename=this.guid()+".png";case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),watch:{},methods:{guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0,r="x"==t?e:3&e|8;return r.toString(16)}))},saveEditAvatar:function(){this.finish("blob")},changeScale:function(t){t=t||1,this.$refs.cropper.changeScale(t)},rotateLeft:function(){this.$refs.cropper.rotateLeft()},rotateRight:function(){this.$refs.cropper.rotateRight()},finish:function(t){var e=this;"blob"===t?this.$refs.cropper.getCropBlob(function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(r){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=3,e.util.uploadFile({driver:e.$store.state.app.uploadDriver,signUrl:"/v1/upload_oss/index/sign",url:"/v1/core/index/upload",header:{token:e.util.getToken()},blobInfo:{blob:function(){return r},filename:function(){return this.filename}}});case 3:i=t.sent,i.data?(e.avatarURL=i.data.url,e.submit()):e.util.showToast({title:"上传失败",icon:"loading",duration:3e3});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()):this.$refs.cropper.getCropData((function(t){}))},realTime:function(t){this.previews=t},down:function(t){var e=document.createElement("a");e.download="author-img","blob"===t?this.$refs.cropper.getCropBlob((function(t){e.href=window.URL.createObjectURL(t),e.click()})):this.$refs.cropper.getCropData((function(t){e.href=t,e.click()}))},uploadImg:function(t){var e=this;this.filename=t.name;var r=new FileReader;r.onload=function(t){var r;r="object"===Object(n["a"])(t.target.result)?window.URL.createObjectURL(new Blob([t.target.result])):t.target.result,e.option.img=r},r.readAsArrayBuffer(t.raw)},submit:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.avatarURL){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.util.request({url:"/v1/core/user/avatar",data:{avatar:t.avatarURL},method:"put"});case 4:r=e.sent,200==r.code?(t.util.showToast({title:r.msg,icon:"success",duration:2e3}),t.$store.state.user.userInfo.avatar=t.avatarURL,t.showPopup=!1):t.util.showToast({title:r.msg,icon:"loading",duration:3e3});case 6:case"end":return e.stop()}}),e)})))()},loadScript:function(){var t=this;return new Promise((function(e,r){t.VueScript2.load("https://cdn.jsdelivr.net/npm/vue-cropper@0.4.9/dist/index.js").then((function(){e()}))}))}}}),s=c,u=(r("ee7f"),r("2877")),l=Object(u["a"])(s,i,o,!1,null,"65d3b479",null);e["default"]=l.exports},c51a:function(t,e,r){},ee7f:function(t,e,r){"use strict";r("c51a")}}]);