(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3f3595df"],{"2e2a":function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"upload-box",class:t.fileList.length>=t.optionsData.limit&&"image"==t.optionsData.type?"hidden-up-btn":""},[i("el-upload",{ref:"upload",class:"upload-"+t.optionsData.type,attrs:{drag:t.optionsData.drag,"show-file-list":t.optionsData.showFileList,"list-type":t.listType,headers:t.headerData,limit:t.optionsData.limit,multiple:1!=t.optionsData.limit,"file-list":t.fileList,"on-preview":t.handlePictureCardPreview,"on-progress":t.handleProgress,"on-success":t.handleSuccess,"on-exceed":t.handleExceed,"before-remove":t.beforeRemove,"on-remove":t.handleRemove,"before-upload":t.handleBeforeUpload,data:t.optionsData.postdata,name:t.name,action:t.optionsData.action,"http-request":t.uploadSectionFile}},[t.fileList.length>=t.optionsData.limit&&1==t.optionsData.limit&&"image"==t.optionsData.type?[i("img",{attrs:{src:t.fileList[0]["url"]}})]:[t.optionsData&&t.optionsData.drag?[t._t("drag",(function(){return["images"==t.optionsData.type?[t._t("icon",(function(){return[i("i",{staticClass:"el-icon-plus",class:t.optionsData.icon?t.optionsData.icon:""})]})),t.optionsData.placeholder?i("div",{staticClass:"el-upload__text"},[t._v(" "+t._s(t.optionsData.placeholder)+" ")]):t._e()]:[t._t("icon",(function(){return[i("i",{staticClass:"el-icon-upload",class:t.optionsData.icon?t.optionsData.icon:""})]})),i("div",{staticClass:"el-upload__text"},[t._v(" "+t._s(t.optionsData.placeholder?t.optionsData.placeholder:"将文件拖到此处，或点击上传")+" ")]),i("div",{staticClass:"font-sm text-gray lh-1-2"},[t._v(" "+t._s(t.optionsData.tip?t.optionsData.tip:"只能上传"+t.optionsData.format+"文件，且不超过"+t.optionsData.maxSize+"KB")+" ")])]]}))]:[i("el-button",{attrs:{size:"small",type:"primary"}},[t._t("btn-text",(function(){return[t._v("点击上传")]}))],2)]],i("el-dialog",{attrs:{"append-to-body":!0,visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},["image"==t.mediaType?[i("img",{attrs:{width:"100%",src:t.dialogImageUrl}})]:"audio"==t.mediaType?[i("audio",{attrs:{src:t.dialogImageUrl,controls:"controls"}},[t._v(" 您的浏览器不支持 audio 标签。 ")])]:"video"==t.mediaType?[i("video",{attrs:{src:t.dialogImageUrl,controls:"controls",width:"700"}},[t._v(" 您的浏览器不支持 video 标签。 ")])]:t._e()],2),i("el-dialog",{attrs:{title:"图片裁剪","append-to-body":!0,visible:t.cropperInit.showCropper,width:"800px"},on:{"update:visible":function(e){return t.$set(t.cropperInit,"showCropper",e)}}},[i("xy-cropper",{attrs:{init:t.cropperInit,imgData:t.cropperImgData,autoCropWidth:t.optionsData.imgWidth,autoCropHeight:t.optionsData.imgHeight},on:{success:t.cropperSuccess}}),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"})],1)],2),t.img.title&&""!==t.img.title?i("div",{staticStyle:{"text-align":"center"}},[t._v(" "+t._s(t.img.title)+" ")]):t._e()],1)},n=[],o=i("1da1"),r=(i("96cf"),i("caad"),i("b0c0"),i("a434"),i("b680"),i("d3b7"),i("2532"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-row",{attrs:{type:"flex",justify:"space-around"}},[i("div",{staticClass:"cropper text-center"},[t.loadedScript?i("vue-cropper",{ref:"cropper",staticClass:"m-b",attrs:{img:t.option.img,outputSize:t.option.size,outputType:t.option.outputType,info:t.option.info,full:t.option.full,canMove:t.option.canMove,canMoveBox:t.option.canMoveBox,original:t.option.original,autoCrop:t.option.autoCrop,autoCropWidth:t.autoCropWidth,autoCropHeight:t.autoCropHeight,fixedBox:t.option.fixedBox},on:{realTime:t.realTime}}):t._e(),i("span",{staticClass:"text-gray ts-14"},[i("i",{staticClass:"xyicon xyicon-help-o ts-14"}),t._v(" 滚动鼠标滚轮来缩放图片 ")])],1),i("div",{staticClass:"previewBox"},[i("div",{staticClass:"preview-wrap",style:t.previews.div},[i("div",{staticClass:"preview",style:t.previews.div},[i("img",{style:t.previews.img,attrs:{src:t.previews.url}})])]),i("el-row",{staticClass:"m-t-md m-b",attrs:{type:"flex",justify:"center"}},[i("el-upload",{attrs:{action:"","show-file-list":!1,"auto-upload":!1,"on-change":t.changeImgData}},[i("el-button",{attrs:{size:"small",type:"primary"}},[t._v(" 更换图片 ")])],1)],1),i("br"),i("el-row",[i("el-button",{attrs:{icon:"el-icon-plus",circle:"",size:"mini"},on:{click:function(e){return t.changeScale(1)}}}),i("el-button",{attrs:{icon:"el-icon-minus",circle:"",size:"mini"},on:{click:function(e){return t.changeScale(-1)}}}),i("el-button",{attrs:{icon:"el-icon-download",circle:"",size:"mini"},on:{click:function(e){return t.down("blob")}}}),i("el-button",{attrs:{icon:"el-icon-refresh-left",circle:"",size:"mini"},on:{click:t.rotateLeft}}),i("el-button",{attrs:{icon:"el-icon-refresh-right",circle:"",size:"mini"},on:{click:t.rotateRight}})],1)],1)]),i("div",{staticClass:"m-t-md flex flex-end p-r-md"},[i("el-button",{attrs:{round:""},on:{click:function(e){t.init.showCropper=!1}}},[t._v("取消")]),i("el-button",{attrs:{type:"primary",round:""},on:{click:t.saveEditAvatar}},[t._v("保存")])],1)],1)}),s=[],l=i("53ca"),p=(i("a9e3"),i("ac1f"),i("5319"),i("25f0"),i("3ca3"),i("ddb0"),i("2b3d"),{name:"XyCropper",props:{init:{type:Object,default:function(){return{showCropper:!1}}},imgData:File,autoCropWidth:{type:Number,default:150},autoCropHeight:{type:Number,default:150}},data:function(){return{loadedScript:!1,filename:"",filesize:0,imgUrl:"",previews:{},option:{img:"",info:!0,outputSize:1,full:!0,outputType:"png",canMove:!0,original:!1,canMoveBox:!0,autoCrop:!0,fixed:!0,fixedBox:!0}}},created:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.loadScript();case 2:Vue.use(window["vue-cropper"].default),this.loadedScript=!0,this.filename=this.guid()+".png",this.changeImgData(this.imgData,!1);case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),watch:{imgData:function(){this.changeImgData(this.imgData,!1)}},methods:{guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0,i="x"==t?e:3&e|8;return i.toString(16)}))},changeImgData:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this;this.filename=t.name,this.filesize=t.size;var a=new FileReader;a.onload=function(t){var e;e="object"===Object(l["a"])(t.target.result)?window.URL.createObjectURL(new Blob([t.target.result])):t.target.result,i.option.img=e},e?a.readAsArrayBuffer(t.row):a.readAsArrayBuffer(t)},saveEditAvatar:function(){this.finish("blob")},finish:function(t){var e=this;"blob"===t?this.$refs.cropper.getCropBlob(function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(i){var a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.filename){t.next=4;break}return alert("文件名获取失败"),t.abrupt("return");case 4:return a=e,t.next=7,e.util.uploadFile({driver:e.init.driver,signUrl:e.init.signUrl,url:e.init.action,header:{token:e.util.getToken()},blobInfo:{blob:function(){return i},filename:function(){return a.filename},size:function(){return i.size}}});case 7:if(n=t.sent,!n.data){t.next=17;break}if(e.imgUrl=n.data.url,e.imgUrl){t.next=12;break}return t.abrupt("return");case 12:n.data.name=e.filename,n.data.size=e.filesize,e.$emit("success",n),t.next=18;break;case 17:e.util.showToast({title:"上传失败",icon:"loading",duration:3e3});case 18:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()):this.$refs.cropper.getCropData((function(t){}))},changeScale:function(t){t=t||1,this.$refs.cropper.changeScale(t)},rotateLeft:function(){this.$refs.cropper.rotateLeft()},rotateRight:function(){this.$refs.cropper.rotateRight()},realTime:function(t){this.previews=t},down:function(t){var e=document.createElement("a");e.download="author-img","blob"===t?this.$refs.cropper.getCropBlob((function(t){e.href=window.URL.createObjectURL(t),e.click()})):this.$refs.cropper.getCropData((function(t){e.href=t,e.click()}))},loadScript:function(){var t=this;return new Promise((function(e,i){t.VueScript2.load("https://cdn.jsdelivr.net/npm/vue-cropper@0.4.9/dist/index.js").then((function(){e()}))}))}}}),c=p,u=(i("50db"),i("2877")),d=Object(u["a"])(c,r,s,!1,null,"19d5b5ca",null),f=d.exports,h={name:"XyUpload",components:{XyCropper:f},props:{item:{type:Object,default:function(){return{extra:{}}}},options:{type:Object,default:function(){return{}}},value:{type:[Array,String],default:function(){return[]}},header:{type:Object,default:function(){return{cloudId:0,eid:0,token:""}}},img:{type:Object,default:function(){return{value:"",title:""}}},upFileList:{type:Array,default:function(){return[]}}},data:function(){return{name:"file",optionsData:{beforeUpload:function(t){return!0},onProgress:function(t,e,i){},onSuccess:function(t,e,i){},showFileList:!0,type:"image",drag:!1,driver:"",signUrl:"",action:"",provider:"",spaceId:"",clientSecret:"",limit:1,icon:"",placeholder:"",tip:"",format:"jpg,png",maxSize:512,splitePiece:!1,mergeUrl:"",disabled:!1,postdata:{},imgWidth:"",imgHeight:"",needCropper:!1},headerData:{},fileList:[],listType:"text",dialogImageUrl:"",dialogVisible:!1,mediaType:"image",cropperInit:{},cropperImgData:null}},mounted:function(){this.optionsData=Object.assign(this.optionsData,this.options,this.item.extra),this.getDefault(),this.headerData={Authorization:this.header.token?this.header.token:this.util.getToken()}},watch:{item:{deep:!0,handler:function(t,e){this.optionsData=Object.assign(this.optionsData,t.extra),this.getDefault()}},options:{deep:!0,handler:function(t,e){this.optionsData=Object.assign(this.optionsData,t),this.getDefault()}},value:{deep:!0,handler:function(t,e){this.getDefault()}},fileList:function(t){}},methods:{getDefault:function(){switch(this.optionsData.type){case"image":this.listType="picture",""==this.value?this.fileList=[]:this.fileList=[{name:"image",url:this.value}];break;case"images":this.listType="picture-card","string"==typeof this.value||null==this.value?this.fileList=[]:this.fileList=this.value;break;default:this.listType="text","string"==typeof this.value||null==this.value?this.fileList=[]:this.fileList=this.value;break}},getFileType:function(t){var e=t.lastIndexOf(".");return-1!=e?t.substring(e+1,t.length).toLowerCase():""},handlePictureCardPreview:function(t){var e=this.getFileType(t.url).toLowerCase();["jpg","png","bmp","ico","jpeg"].includes(e)?this.mediaType="image":["mp3","wav","ogg","ico","jpeg"].includes(e)?this.mediaType="audio":["mp4","ogg"].includes(e)&&(this.mediaType="video"),this.dialogImageUrl=t.url,this.dialogVisible=!0},handleExceed:function(t,e){this.$message.warning("最多上传"+this.optionsData.limit+"个文件")},handleProgress:function(t,e,i){this.optionsData.onProgress(t,e,i)},cropperSuccess:function(t){this.cropperInit.showCropper=!1;var e,i={};200==t.code?(null!==(e=t.data)&&void 0!==e&&e.path&&(i.path=t.data.path),i.url=t.data.url,"image"==this.optionsData.type?this.fileList[0]=i:this.fileList.push(i),this.syncData()):this.$message({message:t.msg,type:"warning"})},syncData:function(){if("image"==this.optionsData.type)this.$emit("input",this.fileList[0].url);else{for(var t=[],e=0;e<this.fileList.length;e++){var i=this.fileList[e];t.push({name:i.name,path:null===i||void 0===i?void 0:i.path,url:i.url,size:null===i||void 0===i?void 0:i.size})}this.$emit("input",t)}},handleSuccess:function(t,e,i){var a;200==t.code?(null!==(a=t.data)&&void 0!==a&&a.path&&(e.path=t.data.path),e.url=t.data.url,this.fileList.push(e),this.syncData(),this.optionsData.onSuccess(t,e,i)):this.$message({message:t.msg,type:"warning"})},beforeRemove:function(t,e){},handleRemove:function(t,e){this.optionsData.disabled?this.$message({message:"只读模式",type:"warning"}):(this.fileList.splice(this.fileList.indexOf(t),1),"image"==this.optionsData.type?this.$emit("input",""):this.$emit("input",this.fileList),this.fileList)},uploadSectionFile:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function i(){var a;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return a=e,i.next=3,a.util.uploadFile({driver:a.optionsData.driver||"default",signUrl:a.optionsData.signUrl||"",url:a.optionsData.action||"",header:a.header,file:t.file,splitePiece:a.optionsData.splitePiece,mergeUrl:a.optionsData.mergeUrl,provider:a.optionsData.provider,spaceId:a.optionsData.spaceId,clientSecret:a.optionsData.clientSecret,onUploadProgress:function(e){var i=e.loaded/e.total*100|0;t.onProgress({percent:i.toFixed(0)})}});case 3:return i.abrupt("return",i.sent);case 4:case"end":return i.stop()}}),i)})))()},handleBeforeUpload:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.abrupt("return",new Promise(function(){var i=Object(o["a"])(regeneratorRuntime.mark((function i(a,n){var o,r,s,l,p;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return"image"!=e.optionsData.type&&"file"!=e.optionsData.type&&(e.optionsData.limit=30),e.cropperInit={showCropper:!1,driver:e.optionsData.driver,signUrl:e.optionsData.signUrl,action:e.optionsData.action},i.next=4,e.optionsData.beforeUpload(t);case 4:if(r=i.sent,r){i.next=8;break}return i.abrupt("return",!1);case 8:if(e,s=e.optionsData.maxSize,l=t.name.substring(t.name.lastIndexOf(".")+1),null===(o=e.optionsData)||void 0===o||!o.format){i.next=16;break}if(null!==(p=e.optionsData)&&void 0!==p&&p.format.includes(l)){i.next=16;break}return e.$message({message:l+"格式不支持 ",type:"warning"}),i.abrupt("return",!1);case 16:if(!(t.size/1024>s)){i.next=20;break}return e.$message({message:"上传文件大小不能超过 "+s+"KB!",type:"warning"}),i.abrupt("return",!1);case 20:if("image"!=e.optionsData.type&&"images"!=e.optionsData.type||!e.optionsData.needCropper){i.next=25;break}return e.cropperImgData=t,e.cropperInit.showCropper=!0,i.abrupt("return",!1);case 25:a();case 26:case"end":return i.stop()}}),i)})));return function(t,e){return i.apply(this,arguments)}}()));case 1:case"end":return i.stop()}}),i)})))()}}},g=h,m=(i("c990"),Object(u["a"])(g,a,n,!1,null,"77edafde",null));e["a"]=m.exports},"50db":function(t,e,i){"use strict";i("928c")},"67b5":function(t,e,i){},"928c":function(t,e,i){},a434:function(t,e,i){"use strict";var a=i("23e7"),n=i("23cb"),o=i("a691"),r=i("50c4"),s=i("7b0b"),l=i("65f0"),p=i("8418"),c=i("1dde"),u=c("splice"),d=Math.max,f=Math.min,h=9007199254740991,g="Maximum allowed length exceeded";a({target:"Array",proto:!0,forced:!u},{splice:function(t,e){var i,a,c,u,m,v,b=s(this),x=r(b.length),D=n(t,x),y=arguments.length;if(0===y?i=a=0:1===y?(i=0,a=x-D):(i=y-2,a=f(d(o(e),0),x-D)),x+i-a>h)throw TypeError(g);for(c=l(b,a),u=0;u<a;u++)m=D+u,m in b&&p(c,u,b[m]);if(c.length=a,i<a){for(u=D;u<x-a;u++)m=u+a,v=u+i,m in b?b[v]=b[m]:delete b[v];for(u=x;u>x-a+i;u--)delete b[u-1]}else if(i>a)for(u=x-a;u>D;u--)m=u+a-1,v=u+i-1,m in b?b[v]=b[m]:delete b[v];for(u=0;u<i;u++)b[u+D]=arguments[u+2];return b.length=x-a+i,c}})},c990:function(t,e,i){"use strict";i("67b5")}}]);